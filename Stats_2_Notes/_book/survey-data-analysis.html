<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Survey data analysis | Course Introduction</title>
  <meta name="description" content="This is a set of course notes for Demography 5283/7283." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Survey data analysis | Course Introduction" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a set of course notes for Demography 5283/7283." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Survey data analysis | Course Introduction" />
  
  <meta name="twitter:description" content="This is a set of course notes for Demography 5283/7283." />
  

<meta name="author" content="Corey Sparks, PhD" />


<meta name="date" content="2021-11-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-r.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DEM 5283/7283 Course Notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to R and Demography</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R?</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#my-assumptions-in-this-book"><i class="fa fa-check"></i><b>1.1.1</b> My assumptions in this book</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#who-is-this-book-for"><i class="fa fa-check"></i><b>1.2</b> Who is this book for?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="hello-bookdown.html"><a href="hello-bookdown.html"><i class="fa fa-check"></i><b>2</b> Hello bookdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="hello-bookdown.html"><a href="hello-bookdown.html#a-section"><i class="fa fa-check"></i><b>2.1</b> A section</a>
<ul>
<li class="chapter" data-level="" data-path="hello-bookdown.html"><a href="hello-bookdown.html#an-unnumbered-section"><i class="fa fa-check"></i>An unnumbered section</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>3</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#welcome-to-r."><i class="fa fa-check"></i><b>3.1</b> Welcome to R.</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-and-rstudio"><i class="fa fa-check"></i><b>3.2</b> R and Rstudio</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#introduction-to-rstudio"><i class="fa fa-check"></i><b>3.3</b> Introduction to Rstudio</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#code-windowsource-editor-pane"><i class="fa fa-check"></i><b>3.3.1</b> Code window/Source editor pane</a></li>
<li class="chapter" data-level="3.3.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#console-pane"><i class="fa fa-check"></i><b>3.3.2</b> Console Pane</a></li>
<li class="chapter" data-level="3.3.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#environment-or-workspace-browser-pane"><i class="fa fa-check"></i><b>3.3.3</b> Environment or Workspace browser pane</a></li>
<li class="chapter" data-level="3.3.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#filesoutputhelp-pane"><i class="fa fa-check"></i><b>3.3.4</b> Files/Output/Help pane</a></li>
<li class="chapter" data-level="3.3.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-file-types"><i class="fa fa-check"></i><b>3.3.5</b> R file types</a></li>
<li class="chapter" data-level="3.3.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-projects"><i class="fa fa-check"></i><b>3.3.6</b> R projects</a></li>
<li class="chapter" data-level="3.3.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-data-files"><i class="fa fa-check"></i><b>3.3.7</b> R data files</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-help-in-r"><i class="fa fa-check"></i><b>3.4</b> Getting help in R</a></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-packages"><i class="fa fa-check"></i><b>3.5</b> R packages</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions-within-packages"><i class="fa fa-check"></i><b>3.5.1</b> Functions within packages</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#your-r-user-environment"><i class="fa fa-check"></i><b>3.6</b> Your R user environment</a></li>
<li class="chapter" data-level="3.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#some-simple-r-examples"><i class="fa fa-check"></i><b>3.7</b> Some Simple R examples</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-is-a-calculator"><i class="fa fa-check"></i><b>3.7.1</b> R is a calculator</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#variables-and-objects"><i class="fa fa-check"></i><b>3.8</b> Variables and objects</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectors"><i class="fa fa-check"></i><b>3.8.1</b> Vectors</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="introduction-to-r.html"><a href="introduction-to-r.html#variable-types"><i class="fa fa-check"></i><b>3.9</b> Variable types</a></li>
<li class="chapter" data-level="3.10" data-path="introduction-to-r.html"><a href="introduction-to-r.html#dataframes"><i class="fa fa-check"></i><b>3.10</b> Dataframes</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#accessing-variables-in-dataframes"><i class="fa fa-check"></i><b>3.10.1</b> Accessing variables in dataframes</a></li>
<li class="chapter" data-level="3.10.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#nicer-looking-tables"><i class="fa fa-check"></i><b>3.10.2</b> Nicer looking tables</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="introduction-to-r.html"><a href="introduction-to-r.html#real-data-example"><i class="fa fa-check"></i><b>3.11</b> Real data example</a></li>
<li class="chapter" data-level="3.12" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-descriptive-analysis-of-data"><i class="fa fa-check"></i><b>3.12</b> Basic Descriptive analysis of data</a>
<ul>
<li class="chapter" data-level="3.12.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#dataframe-summaries"><i class="fa fa-check"></i><b>3.12.1</b> Dataframe summaries</a></li>
<li class="chapter" data-level="3.12.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#frequency-tables"><i class="fa fa-check"></i><b>3.12.2</b> Frequency tables</a></li>
<li class="chapter" data-level="3.12.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#more-basic-statistical-summaries"><i class="fa fa-check"></i><b>3.12.3</b> More basic statistical summaries</a></li>
<li class="chapter" data-level="3.12.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#measures-of-central-tendency"><i class="fa fa-check"></i><b>3.12.4</b> Measures of central tendency</a></li>
<li class="chapter" data-level="3.12.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#mean-and-median"><i class="fa fa-check"></i><b>3.12.5</b> Mean and median</a></li>
<li class="chapter" data-level="3.12.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#measures-of-variation"><i class="fa fa-check"></i><b>3.12.6</b> Measures of variation</a></li>
</ul></li>
<li class="chapter" data-level="3.13" data-path="introduction-to-r.html"><a href="introduction-to-r.html#the-tidyverse"><i class="fa fa-check"></i><b>3.13</b> The tidyverse</a>
<ul>
<li class="chapter" data-level="3.13.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-dplyr"><i class="fa fa-check"></i><b>3.13.1</b> Basic dplyr</a></li>
</ul></li>
<li class="chapter" data-level="3.14" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-ggplot"><i class="fa fa-check"></i><b>3.14</b> Basic ggplot</a>
<ul>
<li class="chapter" data-level="3.14.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#stem-and-leaf-plotsbox-and-whisker-plots"><i class="fa fa-check"></i><b>3.14.1</b> Stem and leaf plots/Box and Whisker plots</a></li>
<li class="chapter" data-level="3.14.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#x-y-scatter-plots"><i class="fa fa-check"></i><b>3.14.2</b> X-Y Scatter plots</a></li>
<li class="chapter" data-level="3.14.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#facet-plots"><i class="fa fa-check"></i><b>3.14.3</b> Facet plots</a></li>
</ul></li>
<li class="chapter" data-level="3.15" data-path="introduction-to-r.html"><a href="introduction-to-r.html#chapter-summary"><i class="fa fa-check"></i><b>3.15</b> Chapter summary</a></li>
<li class="chapter" data-level="3.16" data-path="introduction-to-r.html"><a href="introduction-to-r.html#references"><i class="fa fa-check"></i><b>3.16</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html"><i class="fa fa-check"></i><b>4</b> Survey data analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#demographic-survey-data"><i class="fa fa-check"></i><b>4.1</b> Demographic Survey data</a></li>
<li class="chapter" data-level="4.2" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#basics-of-survey-sampling"><i class="fa fa-check"></i><b>4.2</b> Basics of survey sampling</a></li>
<li class="chapter" data-level="4.3" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#simple-versus-complex-survey-designs"><i class="fa fa-check"></i><b>4.3</b> Simple versus complex survey designs</a></li>
<li class="chapter" data-level="4.4" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#characteristics-of-your-survey"><i class="fa fa-check"></i><b>4.4</b> Characteristics of YOUR survey</a></li>
<li class="chapter" data-level="4.5" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#example-from-the-american-community-survey"><i class="fa fa-check"></i><b>4.5</b> Example from the American Community Survey</a></li>
<li class="chapter" data-level="4.6" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#basics-of-analyzing-survey-data"><i class="fa fa-check"></i><b>4.6</b> Basics of analyzing survey data</a></li>
<li class="chapter" data-level="4.7" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#replicates-and-jack-knifes-and-expansions-oh-my"><i class="fa fa-check"></i><b>4.7</b> Replicates and jack knifes and expansions, oh my!</a></li>
<li class="chapter" data-level="4.8" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#descriptive-analysis-of-survey-data"><i class="fa fa-check"></i><b>4.8</b> Descriptive analysis of survey data</a></li>
<li class="chapter" data-level="4.9" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#weighted-frequencies-and-rates"><i class="fa fa-check"></i><b>4.9</b> Weighted frequencies and rates</a></li>
<li class="chapter" data-level="4.10" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#creating-tables-from-survey-data-analysis"><i class="fa fa-check"></i><b>4.10</b> Creating tables from survey data analysis</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#how-this-differs-from-simple-random-sampling"><i class="fa fa-check"></i><b>4.10.1</b> How this differs from simple random sampling</a></li>
<li class="chapter" data-level="4.10.2" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#how-do-weights-affect-our-estimates"><i class="fa fa-check"></i><b>4.10.2</b> How do weights affect our estimates?</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#basic-statistical-testing-on-survey-data."><i class="fa fa-check"></i><b>4.11</b> Basic statistical testing on survey data.</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#regression-and-survey-design"><i class="fa fa-check"></i><b>4.11.1</b> Regression and survey design</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#more-examples-from-the-cdc-brfss"><i class="fa fa-check"></i><b>4.12</b> More examples from the CDC BRFSS</a>
<ul>
<li class="chapter" data-level="4.12.1" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#fix-variable-names"><i class="fa fa-check"></i><b>4.12.1</b> Fix variable names</a></li>
<li class="chapter" data-level="4.12.2" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#recoding-of-variables"><i class="fa fa-check"></i><b>4.12.2</b> Recoding of variables</a></li>
<li class="chapter" data-level="4.12.3" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#filter-cases"><i class="fa fa-check"></i><b>4.12.3</b> Filter cases</a></li>
<li class="chapter" data-level="4.12.4" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#analysis"><i class="fa fa-check"></i><b>4.12.4</b> Analysis</a></li>
<li class="chapter" data-level="4.12.5" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#create-a-survey-design-object"><i class="fa fa-check"></i><b>4.12.5</b> Create a survey design object</a></li>
<li class="chapter" data-level="4.12.6" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#proper-survey-design-analysis"><i class="fa fa-check"></i><b>4.12.6</b> Proper survey design analysis</a></li>
<li class="chapter" data-level="4.12.7" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#another-way"><i class="fa fa-check"></i><b>4.12.7</b> Another way</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#regression-example"><i class="fa fa-check"></i><b>4.13</b> Regression example</a></li>
<li class="chapter" data-level="4.14" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#creating-survey-estimates-for-places"><i class="fa fa-check"></i><b>4.14</b> Creating Survey estimates for places</a>
<ul>
<li class="chapter" data-level="4.14.1" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#using-srvyr"><i class="fa fa-check"></i><b>4.14.1</b> Using srvyr</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="survey-data-analysis.html"><a href="survey-data-analysis.html#replicate-weights"><i class="fa fa-check"></i><b>4.15</b> Replicate Weights</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Course Introduction</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="survey-data-analysis" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Survey data analysis</h1>
<div id="demographic-survey-data" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Demographic Survey data</h2>
<p>The majority of demographic research relies on two or three main sources of information. First among these are population enumerations or censuses, followed by vital registration data on births and deaths and last but not least, data from surveys. Censuses and other population enumerations are typically undertaken by federal statistical agencies and demographers use this data once it’s disseminated from these agencies. Similarly, vital registration data are usually collected by governmental agencies, who oversee the collection and data quality for the data. Survey data on the other hand can come from a wide variety of sources.</p>
<p>It’s not uncommon for us to go and collect our own survey data specific to a research project we have, typically on a specialized population that we are interested in learning about, but surveys can also be quite general in their scope and collect information on a wide variety of subjects. Owing to the mix of small and large-scale survey data collection efforts, survey data are often available on many different topics, locales and time periods. Of course we as demographers are typically interested in population-level analysis or generalization from our work, so the survey data we try to use are collected in rigorous manners, with much attention and forethought paid to ensure the data we collect can actually be representative of the <em>target population</em> we are trying to describe.</p>
<p>In this chapter, I will introduce the nature of survey sampling as is often used in demographic data sources, and describe what to look for when first using a survey data source for you research. These topics are geared towards researchers and students who have not worked with survey data much in the past and will go over some very pragmatic things to keep in mind. Following this discussion, I will use a specific example from the US Census Bureau’s American Community Survey and illustrate how to apply these principals to this specific source. The final goal of this chapter is to show how to use R to analyze survey data and produce useful summaries from our surveys, both tabular and graphically.</p>
</div>
<div id="basics-of-survey-sampling" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Basics of survey sampling</h2>
<p>To begin this section, I want to go over some of the simple terms from sampling that are very important to those of us who rely on survey data for our work. For many of the concepts from this chapter, I strongly recommend <span class="citation"><a href="#ref-Lohr2019" role="doc-biblioref">Lohr</a> (<a href="#ref-Lohr2019" role="doc-biblioref">2019</a>)</span> for the theoretical portions and <span class="citation"><a href="#ref-lumley2010" role="doc-biblioref">Lumley</a> (<a href="#ref-lumley2010" role="doc-biblioref">2010</a>)</span> for discussion of how R is used for complex survey data.</p>
<p>The <strong>target population</strong> is the population that our survey has been designed to measure. For large national surveys, these are typically the population of the country of interest. For example, the Demographic and Health Survey (DHS) has it’s primary target population as women of childbearing ages in women of reproductive age and their young children living in households. Our <strong>observational units</strong> are the level at which we are collecting data, for surveys this is typically a person or a household, and our survey documentation will tell us what its unit of observation is. <strong>Sampling Units</strong> refer to the units that can serve for us to collect data from, for example we may not have a list of every school age child, but we may have a list of schools, so we may use schools as our sampling units and sample children within them. The <strong>sampling frame</strong> is the set of sampling units containing distinct sets of population members, this is usually the most recent population census, ideally the entire population, or following our school example from above, the entire listing of schools.</p>
<p>These terms are ubiquitous in sampling, but other terminology also exists in many surveys and these terms relate to the nature of how the survey was actually carried out. Many times the surveys we end up using are not themselves <strong>simple random samples</strong>, but are instead some blend of stratified or cluster sample. For example, the DHS uses a stratified, cluster sample to collect its information. <strong>Strata</strong> refer to relatively homogeneous areas within the place we are trying to collect data. In the DHS, these are typically rural or urban areas of a country, as identified by the census. Within each strata, the DHS will choose <strong>clusters</strong> from which to sample from, this is a <strong>two-stage sampling method</strong>, where first the sampling frame is stratified, then clusters are selected. Clusters in the DHS are usually neighborhoods in urban areas and smaller towns or villages in rural areas.</p>
<p>Figure 1 shows a cartoon of how this process works, with multiple potential cluster that can be sampled (boxes), and within the cluster are our observational units, some of which are sampled, and some of which are unsampled.</p>
<div class="figure">
<img src="images/MLdata.png" alt="" />
<p class="caption">Figure 1</p>
</div>
</div>
<div id="simple-versus-complex-survey-designs" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Simple versus complex survey designs</h2>
<p>How the data we’re using is sampled has a major implication for how we analyze it. The majority of statistical tools assume that data come from simple random samples, because most methods assume independence of observations, regardless of which distribution or test statistic you are using. Violations of this assumption are a big problem when we go to analyze our data, because the non-independence of survey data are automatically in violation of a key assumption of any test. The stratified and clustered nature of many survey samples may also present problems for methods such as linear regression analysis which assume errors in the model are <strong>homoskedastic</strong>, or constant. When data are collected in a stratified or clustered method, the data may have less variation than a simple random sample, because individuals who live closely to one another often share other characteristics in common as well. Our statistical models don’t do well with this type of reduction in variation and we often have to resort to manipulations of our model parameters or standard errors of our statistics in order to make them coincide with how the data were collected.</p>
<p>Not to fear! Data collected using public funds are typically required to be made available to the public with information on how to use them. Most surveys come with some kind of code book or user manual which describes how the data were collected and how you should go about using them. In these cases, it pays to read the manual because it will tell you the names of the stratification and clustering variables in the survey data. This will allow you to use the design of the survey in your analysis so that your statistical routines are corrected for the non-randomness and homogeneity in the survey data.</p>
<p><strong>He’s not heavy, he’s my brother</strong></p>
<p>Another important aspect of survey data are the use of weighting variables. Whenever we design a survey, we have our target population, or universe of respondents in mind. In the DHS, again, this is traditionally<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> women of childbearing age and their children <span class="citation">(<a href="#ref-international_demographic_2012" role="doc-biblioref">International 2012</a>)</span>. When we collect a sample from this population, or sample may be, and typically is, imperfect. It is imperfect for many reasons, owing to the difficulty of sampling some members of the population, or their unwillingness to participate in our study. Part of designing an effective survey is knowing your universe or population, and its characteristics. This will let you know the probability of a particular person being in the sample. Of course, the more complicated the survey, the more complicated it is to know what this probability is. For example, if we were to sample people in the United States, using a stratified design based on rural and urban residence, we would need to know how many people lived in rural and urban areas within the country, as this would effect the probability of sampling a person in each type of area. This <strong>inclusion probability</strong> tells us how likely a given person is of being sampled. The inverse of the inclusion probability is called the <strong>sampling weight</strong>:</p>
<p><span class="math inline">\(w_i = \frac{1} {\pi_i}\)</span></p>
<p>where <span class="math inline">\(\pi_i\)</span> is the inclusion probability.</p>
<p>Sampling weights are what we use to make our analyses of a survey representative of the larger population. They serve many purposes including unequal inclusion probabilities, differences in sample characteristics compared to the larger population, and differences in response rates across sample subgroups. All of these situations make the sample deviate from the population by affecting who the actual respondents included in the survey are. Differences in our sample when compared to the larger population can affect most all of our statistical analysis since again, most methods assume random sampling. The weights that are included in public data are the result of a rigorous process conducted by those who designed and implemented the survey itself, and most surveys in their user manuals or code books describe the process of how the weights are created. For example, the US Center for Disease Control and Prevention’s Behavioral Risk Factor Surveillance System (BRFSS) provides a very thorough description of how their final person weights are calculated <span class="citation">(<a href="#ref-cdc2020" role="doc-biblioref">CDC 2020</a>)</span>. These weights include three primary factors, the <em>stratum weight</em>, which is a combination of the number of records in a sample strata and the density of phone lines in a given strata, combined with the number of phones in a sampled household and the number of adults in the household to produce the final design weight. These weights are then <strong>raked</strong> to eight different marginal totals, based on age, race/ethnicity, education, marital status, home ownership, gender by race/ethnicity, age by race/ethnicity and phone ownership<span class="citation">(<a href="#ref-cdc2020" role="doc-biblioref">CDC 2020</a>)</span>. After this process, weights are interpretable as the number of people a given respondent in the survey represents in the population. So, if a respondent’s weight in the survey data is 100, they actually represent 100 people in the target population.</p>
<p>Other types of weights also exist, and are commonly seen in federal data sources. A common kind of weight that includes information on both the probability of inclusion <strong>AND</strong> the stratified design of the survey are <strong>replicate weights</strong>. Replicate weights are multiple weights for each respondent, and there are as many weights as there are different levels of the stratification variable. Later in this chapter, we will discuss how replicate weights are used, as compared to single design weights in an example.</p>
</div>
<div id="characteristics-of-your-survey" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Characteristics of YOUR survey</h2>
<p>Survey data that come from reputable sources, such as most federal agencies or repositories such as the Inter-university Consortium for Political and Social Research (ICPSR) at the University of Michigan in the United States, are accompanied by descriptions of the data source including when and where it was collected, what it’s target population is, and information on the design of the survey. This will include information on sample design, such as stratum or cluster variables, and design or replicate weights to be used when you conduct your analysis. I cannot stress enough that learning how your particular survey data source is designed, and how the designers recommend you use provided survey variables for your analysis, is imperative to ensure your analysis is correctly specified.</p>
</div>
<div id="example-from-the-american-community-survey" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Example from the American Community Survey</h2>
<p>Let’s look at an example of these ideas in a real data source. Throughout the book I will use several complex survey design data sources to illustrate various topics, in this chapter I will use data from the US Census Bureau’s American Community Survey (ACS) public use microdata sample (PUMS). We can actually use the <code>tidycensus</code> package <span class="citation">(<a href="#ref-walker21" role="doc-biblioref">Walker and Herman 2021</a>)</span> to download ACS PUMS directly from the Census Bureau.</p>
<p>This example shows how to extract the 2018 single-year PUMS for the state of Texas, and only keep variables related to person-records. The ACS has information on both people and households, but for now we’ll only look at the person records. Help on these functions can be found by typing <code>?pums_variables</code> and <code>?get_pums</code> in <code>R</code></p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="survey-data-analysis.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb190-2"><a href="survey-data-analysis.html#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb190-3"><a href="survey-data-analysis.html#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="survey-data-analysis.html#cb190-4" aria-hidden="true" tabindex="-1"></a>pums_vars_18<span class="ot">&lt;-</span> pums_variables <span class="sc">%&gt;%</span></span>
<span id="cb190-5"><a href="survey-data-analysis.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span> <span class="dv">2018</span>, survey <span class="sc">==</span> <span class="st">&quot;acs1&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb190-6"><a href="survey-data-analysis.html#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(var_code, var_label, data_type, level) <span class="sc">%&gt;%</span></span>
<span id="cb190-7"><a href="survey-data-analysis.html#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(level <span class="sc">==</span> <span class="st">&quot;person&quot;</span>)</span>
<span id="cb190-8"><a href="survey-data-analysis.html#cb190-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-9"><a href="survey-data-analysis.html#cb190-9" aria-hidden="true" tabindex="-1"></a>TX_pums <span class="ot">&lt;-</span> <span class="fu">get_pums</span>(</span>
<span id="cb190-10"><a href="survey-data-analysis.html#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">c</span>(<span class="st">&quot;PUMA&quot;</span>, <span class="st">&quot;SEX&quot;</span>, <span class="st">&quot;AGEP&quot;</span>, <span class="st">&quot;CIT&quot;</span>, <span class="st">&quot;JWTR&quot;</span>,<span class="st">&quot;JWRIP&quot;</span>, <span class="st">&quot;HISP&quot;</span>),</span>
<span id="cb190-11"><a href="survey-data-analysis.html#cb190-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="st">&quot;AL&quot;</span>,</span>
<span id="cb190-12"><a href="survey-data-analysis.html#cb190-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey =</span> <span class="st">&quot;acs1&quot;</span>,</span>
<span id="cb190-13"><a href="survey-data-analysis.html#cb190-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2018</span>)</span></code></pre></div>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="survey-data-analysis.html#cb191-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb191-2"><a href="survey-data-analysis.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(TX_pums),</span>
<span id="cb191-3"><a href="survey-data-analysis.html#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">&#39;html&#39;</span></span>
<span id="cb191-4"><a href="survey-data-analysis.html#cb191-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>These data are also easily available from the Integrated Public Use Microdata Series (IPUMS) project housed at the University of Minnesota <span class="citation">(<a href="#ref-Ruggles2021" role="doc-biblioref">Ruggles et al. 2021</a>)</span>. The IPUMS version of the data adds additional information to the data and homogenizes the data across multiple years to make using it easier. The following example will use the <code>ipumsr</code> package to read in an extract from IPUMS-USA.</p>
<p>After you create an IPUMS extract, right click on the DDI link and save that file to your computer. Then repeat this for the .DAT file. If you need help creating an IPUMS extract, their staff have created a tutorial for doing so (<a href="https://usa.ipums.org/usa/tutorials.shtml" class="uri">https://usa.ipums.org/usa/tutorials.shtml</a>).</p>
<p>This will save the xml file that contains all the information on the data (what is contained in the data file) to your computer. When using IPUMS, it will have a name like <code>usa_xxxxx.xml</code> where the x’s represent the extract number.</p>
<p>You will also need to download the data file, by right clicking the <strong>Download.DAT</strong> link in the above image. This will save a .gz file to your computer, again with a name like: <code>usa_xxxxx.dat.gz</code>. Make sure this file and the xml file from above are in the same folder.</p>
<p><img src="images/impum1.png" /></p>
<p>The fundamentals of using <code>ipumsr</code> is to specify the name of your <code>.xml</code> file from your extract, and as long as your <code>.tar.gz</code> file from your extract is in the same location, R will read the data. The files on my computer:</p>
<p><img src="images/ipums_files.png" /></p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="survey-data-analysis.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ipumsr)</span>
<span id="cb192-2"><a href="survey-data-analysis.html#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb192-3"><a href="survey-data-analysis.html#cb192-3" aria-hidden="true" tabindex="-1"></a>ddi <span class="ot">&lt;-</span> <span class="fu">read_ipums_ddi</span>(<span class="at">ddi_file =</span> <span class="st">&quot;~/OneDrive - University of Texas at San Antonio/projects/book_data//usa_00097.xml&quot;</span>)</span>
<span id="cb192-4"><a href="survey-data-analysis.html#cb192-4" aria-hidden="true" tabindex="-1"></a>ipums <span class="ot">&lt;-</span> <span class="fu">read_ipums_micro</span>(<span class="at">ddi =</span> ddi)</span></code></pre></div>
<p>Will read in the data, in this case, it is a subset of the 2008 to 2012 single year ACS. This extract is not all of the variables from the ACS, as that would be a very large file and for my purposes here, I don’t need that. My goal for the rest of the chapter is to illustrate how to use the IPUMS as an example of a complex survey design data set and the steps necessary to do so.</p>
</div>
<div id="basics-of-analyzing-survey-data" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Basics of analyzing survey data</h2>
<p>A fundamental part of analyzing complex survey data are knowing the variables within the data that contain the survey design information. The US Census Bureau has documented the design of the survey in a publication <span class="citation">(<a href="#ref-uscensusbureau2014" role="doc-biblioref">US Census Bureau 2014</a>)</span> The IPUMS version of the ACS has two variables <code>STRATA</code> and <code>CLUSTER</code> that describe the two stage process by which the data are collected. Here are a the first few lines of these from the data:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="survey-data-analysis.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb193-2"><a href="survey-data-analysis.html#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb193-3"><a href="survey-data-analysis.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb193-4"><a href="survey-data-analysis.html#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(ipums[, <span class="fu">c</span>(<span class="st">&quot;SERIAL&quot;</span>, <span class="st">&quot;STRATA&quot;</span>, <span class="st">&quot;CLUSTER&quot;</span>)],</span>
<span id="cb193-5"><a href="survey-data-analysis.html#cb193-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">n=</span><span class="dv">10</span>),</span>
<span id="cb193-6"><a href="survey-data-analysis.html#cb193-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">14</span> )</span></code></pre></div>
<p>For the ACS, the strata variable is named, ironically <code>STRATA</code> and the cluster variable <code>CLUSTER</code>. The IPUMS creates the <code>STRATA</code> variable based on the sampling strata in the ACS, and the <code>CLUSTER</code> variable based on households within a stratum. Often in surveys, the clusters may not be households, they could be smaller population aggregates, such as neighborhoods and villages, as in the DHS.</p>
<p>The data also come with housing unit weights and person unit weights, so your analysis can be either representative of housing units or people.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="survey-data-analysis.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(ipums[, <span class="fu">c</span>(<span class="st">&quot;SERIAL&quot;</span>, <span class="st">&quot;STRATA&quot;</span>, <span class="st">&quot;CLUSTER&quot;</span>, <span class="st">&quot;HHWT&quot;</span>, <span class="st">&quot;PERWT&quot;</span>)],</span>
<span id="cb194-2"><a href="survey-data-analysis.html#cb194-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">n=</span><span class="dv">10</span>),</span>
<span id="cb194-3"><a href="survey-data-analysis.html#cb194-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">14</span> )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">SERIAL</th>
<th align="right">STRATA</th>
<th align="right">CLUSTER</th>
<th align="right">HHWT</th>
<th align="right">PERWT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1189369</td>
<td align="right">330148</td>
<td align="right">2019011893691</td>
<td align="right">67</td>
<td align="right">67</td>
</tr>
<tr class="even">
<td align="right">1189370</td>
<td align="right">231948</td>
<td align="right">2019011893701</td>
<td align="right">43</td>
<td align="right">43</td>
</tr>
<tr class="odd">
<td align="right">1189371</td>
<td align="right">690048</td>
<td align="right">2019011893711</td>
<td align="right">114</td>
<td align="right">114</td>
</tr>
<tr class="even">
<td align="right">1189372</td>
<td align="right">430248</td>
<td align="right">2019011893721</td>
<td align="right">34</td>
<td align="right">34</td>
</tr>
<tr class="odd">
<td align="right">1189373</td>
<td align="right">650048</td>
<td align="right">2019011893731</td>
<td align="right">35</td>
<td align="right">35</td>
</tr>
<tr class="even">
<td align="right">1189374</td>
<td align="right">680548</td>
<td align="right">2019011893741</td>
<td align="right">19</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="right">1189375</td>
<td align="right">340048</td>
<td align="right">2019011893751</td>
<td align="right">18</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="right">1189376</td>
<td align="right">60048</td>
<td align="right">2019011893761</td>
<td align="right">37</td>
<td align="right">37</td>
</tr>
<tr class="odd">
<td align="right">1189377</td>
<td align="right">440048</td>
<td align="right">2019011893771</td>
<td align="right">76</td>
<td align="right">76</td>
</tr>
<tr class="even">
<td align="right">1189378</td>
<td align="right">462348</td>
<td align="right">2019011893781</td>
<td align="right">10</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
<p>As can be seen in the first few cases, the <code>HHWT</code> variable is the same for everyone in a given household, but each person has a unique person weight showing that they each represent different numbers of people in the population. Further investigation of the housing and person weights allow us to see what these values actually look like.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="survey-data-analysis.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ipums<span class="sc">$</span>PERWT)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     1.0    49.0    78.0   106.3   128.0  2376.0</code></pre>
<p>Here we see the minimum person weight is 1 and the maximum is 2376, which tells us that at least on person in the data represents 2376 people in the population that year. A histogram of the weights can also show us the distribution of weights in the sample.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="survey-data-analysis.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb197-2"><a href="survey-data-analysis.html#cb197-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-3"><a href="survey-data-analysis.html#cb197-3" aria-hidden="true" tabindex="-1"></a>ipums<span class="sc">%&gt;%</span></span>
<span id="cb197-4"><a href="survey-data-analysis.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PERWT)) <span class="sc">+</span></span>
<span id="cb197-5"><a href="survey-data-analysis.html#cb197-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb197-6"><a href="survey-data-analysis.html#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Histogram of ACS Person Weights, 2019&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<p>We can see how the weights inflate each person or household to the population by summing the weights. Below, I sum the person weights for the state of Texas, the sum is 28,995,881 million people, which is the same as the official estimate of the population in 2019 (<a href="https://www.census.gov/quickfacts/TX" class="uri">https://www.census.gov/quickfacts/TX</a>), we also see, by using the <code>n()</code> function, that there were 272,776 persons in the sample in 2019 living in Texas.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="survey-data-analysis.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb198-2"><a href="survey-data-analysis.html#cb198-2" aria-hidden="true" tabindex="-1"></a>ipums<span class="sc">%&gt;%</span></span>
<span id="cb198-3"><a href="survey-data-analysis.html#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATEFIP <span class="sc">==</span> <span class="dv">48</span>)<span class="sc">%&gt;%</span></span>
<span id="cb198-4"><a href="survey-data-analysis.html#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_pop =</span> <span class="fu">sum</span>( PERWT ) , <span class="at">n_respond =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    tot_pop n_respond
##      &lt;dbl&gt;     &lt;int&gt;
## 1 28995881    272776</code></pre>
<p>For housing units, we have to select a single person from the household in order for the same process to work, otherwise we would misrepresent the number of households in the state. We see there are 10,585,803 million housing units, and 114,016 unique households in the data.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="survey-data-analysis.html#cb200-1" aria-hidden="true" tabindex="-1"></a>ipums<span class="sc">%&gt;%</span></span>
<span id="cb200-2"><a href="survey-data-analysis.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATEFIP <span class="sc">==</span> <span class="dv">48</span>,</span>
<span id="cb200-3"><a href="survey-data-analysis.html#cb200-3" aria-hidden="true" tabindex="-1"></a>         PERNUM <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb200-4"><a href="survey-data-analysis.html#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tothh =</span> <span class="fu">sum</span>( HHWT ) , <span class="at">n_housing =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##      tothh n_housing
##      &lt;dbl&gt;     &lt;int&gt;
## 1 10585803    114016</code></pre>
<p>This total is nearly identical to that from the <a href="https://data.census.gov/cedsci/table?t=Housing&amp;g=0400000US48&amp;y=2019&amp;tid=ACSDP1Y2019.DP04">Census’s ACS estimate</a>.</p>
<p>This exercise shows that by using the provided weights in the survey, we can estimate the population size the sample was supposed to capture effectively. The <code>survey</code> package and the newer tidyverse package <code>srvyr</code> are designed to fully implement survey design and weighting and perform a wide variety of statistical summaries.</p>
<p>The way these packages work, is that you provide the name of your data frame, and the survey design variables that are in your data and the package code performs the requested analysis, correcting for survey design and weighting to the appropriate population. The code below illustrates how to enter the survey design for the IPUMS-USA ACS. Some surveys will not have both a cluster and stratification variable, so again, it’s important to consult your survey documentation to find these for your data.</p>
<p>The function <code>as_survey_design()</code> in this case takes three arguments, since we are piping the 2019 ACS into it, we don’t have to specify the name of the data. <code>ids</code> is the argument for the cluster variable, if your survey doesn’t have one, just leave it out. <code>strata</code> is where you specify the name of the survey stratification variable, and <code>weights</code> is where you specify the name of the appropriate weighting variable. In this case, I’m replicating the estimate of the housing units in Texas from above, so I’ll use the <code>HHWT</code> variable. The easiest way to get a total population estimate is to use the <code>survey_total()</code> function, which is equivalent to summing the weights as shown above, although in the case of the survey analysis commands in the <code>survey</code> and <code>srvyr</code> packages, the total will also be estimated with a standard error of the estimate.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="survey-data-analysis.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb202-2"><a href="survey-data-analysis.html#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb202-3"><a href="survey-data-analysis.html#cb202-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-4"><a href="survey-data-analysis.html#cb202-4" aria-hidden="true" tabindex="-1"></a>ipums<span class="sc">%&gt;%</span></span>
<span id="cb202-5"><a href="survey-data-analysis.html#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATEFIP <span class="sc">==</span> <span class="dv">48</span>, PERNUM <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb202-6"><a href="survey-data-analysis.html#cb202-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster=</span> CLUSTER,</span>
<span id="cb202-7"><a href="survey-data-analysis.html#cb202-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb202-8"><a href="survey-data-analysis.html#cb202-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> HHWT)<span class="sc">%&gt;%</span></span>
<span id="cb202-9"><a href="survey-data-analysis.html#cb202-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tothh =</span> <span class="fu">survey_total</span>())</span></code></pre></div>
<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class="blue">
<p><strong>A short aside about survey design options</strong>
The core definition of the ACS survey design is shown in the code above, and I highly recommend that you inspect the help file for the survey design functions <code>?as_survey_design</code> or <code>?svydesign</code>. An important option that often has to be specified is the <code>nest=TRUE</code> option. This if often necessary if PSU identifiers are not unique across strata. For example, the fictional data shown below has the PSU’s values the same across strata.}</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="survey-data-analysis.html#cb203-1" aria-hidden="true" tabindex="-1"></a>fake_survey<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb203-2"><a href="survey-data-analysis.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb203-3"><a href="survey-data-analysis.html#cb203-3" aria-hidden="true" tabindex="-1"></a>             <span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb203-4"><a href="survey-data-analysis.html#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">psu =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,</span>
<span id="cb203-5"><a href="survey-data-analysis.html#cb203-5" aria-hidden="true" tabindex="-1"></a>          <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb203-6"><a href="survey-data-analysis.html#cb203-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">12</span>, <span class="at">lambda =</span> <span class="dv">20</span>))</span>
<span id="cb203-7"><a href="survey-data-analysis.html#cb203-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-8"><a href="survey-data-analysis.html#cb203-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(fake_survey)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">strata</th>
<th align="right">psu</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">2</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">3</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">3</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
<p>If we attempt to make a survey design from this, R would show an error.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="survey-data-analysis.html#cb204-1" aria-hidden="true" tabindex="-1"></a>fake_design<span class="ot">&lt;-</span> fake_survey<span class="sc">%&gt;%</span></span>
<span id="cb204-2"><a href="survey-data-analysis.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> psu,</span>
<span id="cb204-3"><a href="survey-data-analysis.html#cb204-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">strata=</span>strata,</span>
<span id="cb204-4"><a href="survey-data-analysis.html#cb204-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">weights =</span> weight)</span></code></pre></div>
<pre><code>## Error in svydesign.default(ids, probs, strata, variables, fpc, .data, : Clusters not nested in strata at top level; you may want nest=TRUE.</code></pre>
<p>But if we include the <code>nest = TRUE</code> option, R doesn’t give us the error:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="survey-data-analysis.html#cb206-1" aria-hidden="true" tabindex="-1"></a>fake_design<span class="ot">&lt;-</span> fake_survey<span class="sc">%&gt;%</span></span>
<span id="cb206-2"><a href="survey-data-analysis.html#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> psu,</span>
<span id="cb206-3"><a href="survey-data-analysis.html#cb206-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">strata=</span>strata,</span>
<span id="cb206-4"><a href="survey-data-analysis.html#cb206-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">weights =</span> weight, </span>
<span id="cb206-5"><a href="survey-data-analysis.html#cb206-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb206-6"><a href="survey-data-analysis.html#cb206-6" aria-hidden="true" tabindex="-1"></a>fake_design</span></code></pre></div>
<pre><code>## Stratified 1 - level Cluster Sampling design (with replacement)
## With (6) clusters.
## Called via srvyr
## Sampling variables:
##  - ids: psu
##  - strata: strata
##  - weights: weight
## Data variables: strata (dbl), psu (dbl), weight (int)</code></pre>
<p>The ACS from IPUMS has unique CLUSTERs across strata, so we don’t have to specify that argument when we declare our survey design.</p>
</div>
<p>Back to our housing estimates.</p>
<p>In this case, our <code>tothh</code> estimate is identical to summing the weights, but new we also have an estimate of the precision of the estimate, so we could produce a more informed statistical estimate that in 2019, there were 10,585,803 <span class="math inline">\(\pm\)</span> 27,274.96 occupied housing units in the state.</p>
<p>If your data come with replicate weights instead of strata and cluster variables, this can be specified using the <code>as_survey_rep()</code> command instead <code>as_survey_design()</code>. In this case, we have to specify all of the columns which correspond to the replicate weights in the data. There are likely many ways to do this, but below, I use a method that matches the column names using a regular expression, where we are looking for the string <code>REPWT</code>, followed by any number of numeric digits, that is what the <code>[0-9]+</code> portion tells R to do. Also, the ACS uses a balanced replicate weight construction, which also requires the case weight as well <span class="citation">(<a href="#ref-Ruggles2021" role="doc-biblioref">Ruggles et al. 2021</a>)</span>, so we specify the replicate weight type as <code>BRR</code>. Again, this is specific to the ACS, and you need to consult your own code book for your survey for your design information.</p>
<p>In this case, we get the same estimate for the total number of housing units, but a smaller variance in the estimate, which is often seen when using replicate weights.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="survey-data-analysis.html#cb208-1" aria-hidden="true" tabindex="-1"></a>ipums<span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="survey-data-analysis.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATEFIP <span class="sc">==</span> <span class="dv">48</span>, PERNUM <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb208-3"><a href="survey-data-analysis.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_rep</span>(<span class="at">weight =</span> HHWT,</span>
<span id="cb208-4"><a href="survey-data-analysis.html#cb208-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">repweights =</span><span class="fu">matches</span>(<span class="st">&quot;REPWT[0-9]+&quot;</span>),</span>
<span id="cb208-5"><a href="survey-data-analysis.html#cb208-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;JK1&quot;</span>,</span>
<span id="cb208-6"><a href="survey-data-analysis.html#cb208-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">scale =</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">80</span>,</span>
<span id="cb208-7"><a href="survey-data-analysis.html#cb208-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">80</span>),</span>
<span id="cb208-8"><a href="survey-data-analysis.html#cb208-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">mse =</span> <span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb208-9"><a href="survey-data-analysis.html#cb208-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tothh =</span> <span class="fu">survey_total</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##      tothh tothh_se
##      &lt;dbl&gt;    &lt;dbl&gt;
## 1 10585803   15479.</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="survey-data-analysis.html#cb210-1" aria-hidden="true" tabindex="-1"></a>rw<span class="ot">&lt;-</span>ipums<span class="sc">%&gt;%</span></span>
<span id="cb210-2"><a href="survey-data-analysis.html#cb210-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(STATEFIP<span class="sc">==</span><span class="dv">48</span>, PERNUM<span class="sc">==</span><span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb210-3"><a href="survey-data-analysis.html#cb210-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(REPWT1<span class="sc">:</span>REPWT50)</span>
<span id="cb210-4"><a href="survey-data-analysis.html#cb210-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-5"><a href="survey-data-analysis.html#cb210-5" aria-hidden="true" tabindex="-1"></a>t1<span class="ot">&lt;-</span>survey<span class="sc">::</span><span class="fu">svrepdesign</span>(<span class="at">data=</span>ipums[ipums<span class="sc">$</span>STATEFIP<span class="sc">==</span><span class="dv">48</span><span class="sc">&amp;</span>ipums<span class="sc">$</span>PERNUM<span class="sc">==</span><span class="dv">1</span>,],</span>
<span id="cb210-6"><a href="survey-data-analysis.html#cb210-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">repweights =</span> rw,</span>
<span id="cb210-7"><a href="survey-data-analysis.html#cb210-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weights =</span> ipums<span class="sc">$</span>HHWT[ipums<span class="sc">$</span>STATEFIP<span class="sc">==</span><span class="dv">48</span><span class="sc">&amp;</span>ipums<span class="sc">$</span>PERNUM<span class="sc">==</span><span class="dv">1</span>],</span>
<span id="cb210-8"><a href="survey-data-analysis.html#cb210-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">type=</span><span class="st">&quot;JK1&quot;</span>,<span class="at">scale =</span> .<span class="dv">05</span>, <span class="at">rscales =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(rw)), <span class="at">mse=</span> <span class="cn">TRUE</span>)</span>
<span id="cb210-9"><a href="survey-data-analysis.html#cb210-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-10"><a href="survey-data-analysis.html#cb210-10" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">$</span>variables<span class="sc">$</span>ones<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb210-11"><a href="survey-data-analysis.html#cb210-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb210-12"><a href="survey-data-analysis.html#cb210-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-13"><a href="survey-data-analysis.html#cb210-13" aria-hidden="true" tabindex="-1"></a><span class="fu">svytotal</span>(<span class="sc">~</span>ones, <span class="at">design=</span>t1)</span></code></pre></div>
<pre><code>##         total    SE
## ones 10585803 11850</code></pre>
<p>We can also define the survey design outside of a dplyr pipe if we want using the <code>survey</code> package.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="survey-data-analysis.html#cb212-1" aria-hidden="true" tabindex="-1"></a>acs_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span> CLUSTER, </span>
<span id="cb212-2"><a href="survey-data-analysis.html#cb212-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">strata=</span> <span class="sc">~</span> STRATA, </span>
<span id="cb212-3"><a href="survey-data-analysis.html#cb212-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weights =</span> <span class="sc">~</span> PERWT, </span>
<span id="cb212-4"><a href="survey-data-analysis.html#cb212-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data=</span>ipums)</span>
<span id="cb212-5"><a href="survey-data-analysis.html#cb212-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-6"><a href="survey-data-analysis.html#cb212-6" aria-hidden="true" tabindex="-1"></a>acs_design</span></code></pre></div>
<pre><code>## Stratified 1 - level Cluster Sampling design (with replacement)
## With (114016) clusters.
## svydesign(ids = ~CLUSTER, strata = ~STRATA, weights = ~PERWT, 
##     data = ipums)</code></pre>
<p>Of course we typically want to do more analysis than just estimate a population size, and typically we are interested in using survey data for comparisons and regression modeling. To carry out any sort of statistical testing on survey data, we must not only weight the data appropriately but we must also calculate all measures of variability correctly as well. Since surveys are stratified, the traditional formula for variances is not correct because under stratified sampling, all estimates are not only a function of the total sample, but also the within-strata sample averages and sample sizes. We can estimate the variances in our estimates using the design variables and sample weights in the survey analysis procedures, but there are options.</p>
</div>
<div id="replicates-and-jack-knifes-and-expansions-oh-my" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Replicates and jack knifes and expansions, oh my!</h2>
<p>When conducting your analysis, you may not have any choices of whether you should use replicate weights or design weights, because your survey may only have one of these. There are two main strategies to estimate variances in survey data, the <em>Taylor Series Approximation</em> also referred to as <em>linearization</em> and the use of <em>replicate weights</em>. The Taylor Series, or linearization method is an approximation to the true variance, but is likely the most commonly used technique when analyzing survey data using regression methods. <span class="citation"><a href="#ref-Lohr2019" role="doc-biblioref">Lohr</a> (<a href="#ref-Lohr2019" role="doc-biblioref">2019</a>)</span> describes the calculation of variances from simple and clustered random samples in her book, and by her admission, once one has a clustered random sample the variance calculations for simple calculations becomes much more complex.</p>
<p>The problem is that we often want much more complicated calculations in our work and the variance formulas for anything other than simple ratios are not analytically known. The Taylor series approximation to the variance for complex and nonlinear terms such as ratios or estimates of regression parameters. The <code>survey</code> package in R will do this if you specify a survey design that includes strata or clusters, while if you specify replicate weights then it will use an appropriate technique depending on how the data were collected.</p>
<p>Typical replicate methods include balanced replicates, where there are exactly two clusters within each stratum, jackknife methods, which effectively remove one cluster from the strata and perform all calculations without that cluster in the analysis, then average across all replicates, and bootstrap methods which randomly sample clusters within strata with replacement a large number of times to get an estimate of the quantities of interest.</p>
</div>
<div id="descriptive-analysis-of-survey-data" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Descriptive analysis of survey data</h2>
<p>The <code>survey</code> library allows many forms of descriptive and regression analysis.</p>
</div>
<div id="weighted-frequencies-and-rates" class="section level2" number="4.9">
<h2><span class="header-section-number">4.9</span> Weighted frequencies and rates</h2>
<p>Basic frequency tables are very useful tools for examining bivariate associations in survey data. In the survey analysis packages in R, the basic tools for doing this are the <code>svytable()</code> function in <code>survey</code>, or via the <code>survey_total()</code> function in <code>srvyr</code>. First I will recode two variables in the ACS, the employment status to indicate if a respondent is currently employed, and the <code>MET2013</code> variable, which is the metropolitan area where the respondent was living. This will give us the ACS estimate for the employed and unemployed population in each Texas MSA. I first have to filter the data to be people of working age, who are in the labor force and living in a MSA.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="survey-data-analysis.html#cb214-1" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb214-2"><a href="survey-data-analysis.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb214-3"><a href="survey-data-analysis.html#cb214-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb214-4"><a href="survey-data-analysis.html#cb214-4" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb214-5"><a href="survey-data-analysis.html#cb214-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">employed =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(.<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Employed&quot;</span>,</span>
<span id="cb214-6"><a href="survey-data-analysis.html#cb214-6" aria-hidden="true" tabindex="-1"></a>                              .<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;Unemployed&quot;</span> )),</span>
<span id="cb214-7"><a href="survey-data-analysis.html#cb214-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013)) <span class="sc">%&gt;%</span></span>
<span id="cb214-8"><a href="survey-data-analysis.html#cb214-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb214-9"><a href="survey-data-analysis.html#cb214-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb214-10"><a href="survey-data-analysis.html#cb214-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb214-11"><a href="survey-data-analysis.html#cb214-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(met_name, employed)<span class="sc">%&gt;%</span></span>
<span id="cb214-12"><a href="survey-data-analysis.html#cb214-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">emp_rate =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb214-13"><a href="survey-data-analysis.html#cb214-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   met_name [3]
##   met_name                 employed   emp_rate emp_rate_se
##   &lt;fct&gt;                    &lt;fct&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1 Amarillo, TX             Employed     114201       2824.
## 2 Amarillo, TX             Unemployed     3761        843.
## 3 Austin-Round Rock, TX    Employed    1193654      10735.
## 4 Austin-Round Rock, TX    Unemployed    47998       3247.
## 5 Beaumont-Port Arthur, TX Employed     163936       3513.
## 6 Beaumont-Port Arthur, TX Unemployed     5851        774.</code></pre>
<p>This is OK, but if we want the totals in columns versus rows, we need to reshape the data. To go from the current “long” form of the variables to a wide form, we can use <code>pivot_wider</code> in <code>dplyr</code>.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="survey-data-analysis.html#cb216-1" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb216-2"><a href="survey-data-analysis.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb216-3"><a href="survey-data-analysis.html#cb216-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb216-4"><a href="survey-data-analysis.html#cb216-4" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb216-5"><a href="survey-data-analysis.html#cb216-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">employed =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(.<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Employed&quot;</span>,</span>
<span id="cb216-6"><a href="survey-data-analysis.html#cb216-6" aria-hidden="true" tabindex="-1"></a>                              .<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;Unemployed&quot;</span> )),</span>
<span id="cb216-7"><a href="survey-data-analysis.html#cb216-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013)) <span class="sc">%&gt;%</span></span>
<span id="cb216-8"><a href="survey-data-analysis.html#cb216-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb216-9"><a href="survey-data-analysis.html#cb216-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb216-10"><a href="survey-data-analysis.html#cb216-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb216-11"><a href="survey-data-analysis.html#cb216-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(met_name, employed)<span class="sc">%&gt;%</span></span>
<span id="cb216-12"><a href="survey-data-analysis.html#cb216-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">emp_rate =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb216-13"><a href="survey-data-analysis.html#cb216-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id =</span> met_name,</span>
<span id="cb216-14"><a href="survey-data-analysis.html#cb216-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> employed,</span>
<span id="cb216-15"><a href="survey-data-analysis.html#cb216-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(emp_rate, emp_rate_se) ) <span class="sc">%&gt;%</span></span>
<span id="cb216-16"><a href="survey-data-analysis.html#cb216-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
## # Groups:   met_name [6]
##   met_name   emp_rate_Employ~ emp_rate_Unempl~ emp_rate_se_Emp~ emp_rate_se_Une~
##   &lt;fct&gt;                 &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 Amarillo,~           114201             3761            2824.             843.
## 2 Austin-Ro~          1193654            47998           10735.            3247.
## 3 Beaumont-~           163936             5851            3513.             774.
## 4 Brownsvil~           161922             8153            3500.            1267.
## 5 College S~           111576             3517            3132.             686.
## 6 Corpus Ch~           208801            12365            4222.            1536.</code></pre>
<p>Of course, if we want rates, this would imply us having to divide these columns to calculate the rate, but we can also get R to do this for us using <code>survey_mean()</code>. Since the <code>employed</code> variable is dichotomous, if we take the mean of its various levels, we get a proportion, in this case the employment and unemployment rates, respectively.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="survey-data-analysis.html#cb218-1" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb218-2"><a href="survey-data-analysis.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb218-3"><a href="survey-data-analysis.html#cb218-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb218-4"><a href="survey-data-analysis.html#cb218-4" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb218-5"><a href="survey-data-analysis.html#cb218-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">employed =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(.<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Employed&quot;</span>,</span>
<span id="cb218-6"><a href="survey-data-analysis.html#cb218-6" aria-hidden="true" tabindex="-1"></a>                              .<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;Unemployed&quot;</span> )),</span>
<span id="cb218-7"><a href="survey-data-analysis.html#cb218-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013)) <span class="sc">%&gt;%</span></span>
<span id="cb218-8"><a href="survey-data-analysis.html#cb218-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb218-9"><a href="survey-data-analysis.html#cb218-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb218-10"><a href="survey-data-analysis.html#cb218-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb218-11"><a href="survey-data-analysis.html#cb218-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(met_name, employed)<span class="sc">%&gt;%</span></span>
<span id="cb218-12"><a href="survey-data-analysis.html#cb218-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">emp_rate =</span> <span class="fu">survey_mean</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb218-13"><a href="survey-data-analysis.html#cb218-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id =</span> met_name,</span>
<span id="cb218-14"><a href="survey-data-analysis.html#cb218-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> employed,</span>
<span id="cb218-15"><a href="survey-data-analysis.html#cb218-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(emp_rate, emp_rate_se) ) <span class="sc">%&gt;%</span></span>
<span id="cb218-16"><a href="survey-data-analysis.html#cb218-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
## # Groups:   met_name [6]
##   met_name   emp_rate_Employ~ emp_rate_Unempl~ emp_rate_se_Emp~ emp_rate_se_Une~
##   &lt;fct&gt;                 &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 Amarillo,~            0.968           0.0319          0.00706          0.00706
## 2 Austin-Ro~            0.961           0.0387          0.00259          0.00259
## 3 Beaumont-~            0.966           0.0345          0.00461          0.00461
## 4 Brownsvil~            0.952           0.0479          0.00735          0.00735
## 5 College S~            0.969           0.0306          0.00599          0.00599
## 6 Corpus Ch~            0.944           0.0559          0.00684          0.00684</code></pre>
<p>Which gets us the employment rate and the unemployment rate for each metropolitan area, with their associated standard errors. This is a general process that would work well for any grouping variable. If we create an object from this calculation, in this case I’ll call it <code>tx_rates</code>, then we can also easily feed it into <code>ggplot</code> to visualize the rates with their associated 95% confidence intervals. The <code>geom_errorbar</code> addition to a <code>ggplot</code> object can add errors to estimates, which are great because we convey the uncertainty in the rates.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="survey-data-analysis.html#cb220-1" aria-hidden="true" tabindex="-1"></a>tx_rates<span class="sc">%&gt;%</span></span>
<span id="cb220-2"><a href="survey-data-analysis.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb220-3"><a href="survey-data-analysis.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>met_name, <span class="at">y =</span> emp_rate_Unemployed), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb220-4"><a href="survey-data-analysis.html#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x=</span>met_name,</span>
<span id="cb220-5"><a href="survey-data-analysis.html#cb220-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin=</span>emp_rate_Unemployed<span class="fl">-1.96</span><span class="sc">*</span>emp_rate_se_Unemployed,</span>
<span id="cb220-6"><a href="survey-data-analysis.html#cb220-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax=</span> emp_rate_Unemployed<span class="fl">+1.96</span><span class="sc">*</span>emp_rate_se_Unemployed),</span>
<span id="cb220-7"><a href="survey-data-analysis.html#cb220-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">width=</span>.<span class="dv">25</span>)<span class="sc">+</span></span>
<span id="cb220-8"><a href="survey-data-analysis.html#cb220-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)<span class="sc">+</span></span>
<span id="cb220-9"><a href="survey-data-analysis.html#cb220-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;MSA&quot;</span>, </span>
<span id="cb220-10"><a href="survey-data-analysis.html#cb220-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Unemployment Rate&quot;</span>,</span>
<span id="cb220-11"><a href="survey-data-analysis.html#cb220-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Unmployment rate in Texas MSAs&quot;</span>)<span class="sc">+</span></span>
<span id="cb220-12"><a href="survey-data-analysis.html#cb220-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-101-1.png" width="672" />
We see that among the first 6 MSAs in the state (that are in the ACS microdata), Corpus Christi has the highest unemployment rate a %, and College Station-Bryan has the lowest unemployment rate at %.</p>
<p>We can also use these functions for continuous variables, say with incomes. In the code below, I pipe all the elements of the analysis together to illustrate the workflow that we can do to calculate the median income in each MSA and plot it along with its error.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="survey-data-analysis.html#cb221-1" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb221-2"><a href="survey-data-analysis.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb221-3"><a href="survey-data-analysis.html#cb221-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb221-4"><a href="survey-data-analysis.html#cb221-4" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-5"><a href="survey-data-analysis.html#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income =</span> <span class="fu">ifelse</span>(INCWAGE <span class="sc">&lt;=</span> <span class="dv">0</span>, <span class="cn">NA</span>, INCWAGE),</span>
<span id="cb221-6"><a href="survey-data-analysis.html#cb221-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013)) <span class="sc">%&gt;%</span></span>
<span id="cb221-7"><a href="survey-data-analysis.html#cb221-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb221-8"><a href="survey-data-analysis.html#cb221-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb221-9"><a href="survey-data-analysis.html#cb221-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb221-10"><a href="survey-data-analysis.html#cb221-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(met_name)<span class="sc">%&gt;%</span></span>
<span id="cb221-11"><a href="survey-data-analysis.html#cb221-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_wage =</span> <span class="fu">survey_median</span>(income, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span>  </span>
<span id="cb221-12"><a href="survey-data-analysis.html#cb221-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb221-13"><a href="survey-data-analysis.html#cb221-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb221-14"><a href="survey-data-analysis.html#cb221-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>met_name, <span class="at">y =</span> median_wage), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb221-15"><a href="survey-data-analysis.html#cb221-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">x=</span>met_name,</span>
<span id="cb221-16"><a href="survey-data-analysis.html#cb221-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin=</span>median_wage<span class="fl">-1.96</span><span class="sc">*</span>median_wage_se,</span>
<span id="cb221-17"><a href="survey-data-analysis.html#cb221-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax=</span> median_wage<span class="fl">+1.96</span><span class="sc">*</span>median_wage_se),</span>
<span id="cb221-18"><a href="survey-data-analysis.html#cb221-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">width=</span>.<span class="dv">25</span>)<span class="sc">+</span></span>
<span id="cb221-19"><a href="survey-data-analysis.html#cb221-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)<span class="sc">+</span></span>
<span id="cb221-20"><a href="survey-data-analysis.html#cb221-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;MSA&quot;</span>, </span>
<span id="cb221-21"><a href="survey-data-analysis.html#cb221-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Median Wage&quot;</span>,</span>
<span id="cb221-22"><a href="survey-data-analysis.html#cb221-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Median wage in Texas MSAs&quot;</span>)<span class="sc">+</span></span>
<span id="cb221-23"><a href="survey-data-analysis.html#cb221-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-102-1.png" width="672" />
Which shows that Austin-Round Rock has the highest median wage and Brownsville-Harlingen has the lowest median wage.</p>
</div>
<div id="creating-tables-from-survey-data-analysis" class="section level2" number="4.10">
<h2><span class="header-section-number">4.10</span> Creating tables from survey data analysis</h2>
<p>Tabular output from our survey data analysis is possible through several different means. When using dplyr, our intermediate output of the analysis is always a data frame, and so any R method for printing data frames would work for simple tabular display. For instance, if we just use <code>knitr::kable()</code> on our workflow from above instead of piping into a plot we would get something like this:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="survey-data-analysis.html#cb222-1" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb222-2"><a href="survey-data-analysis.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb222-3"><a href="survey-data-analysis.html#cb222-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb222-4"><a href="survey-data-analysis.html#cb222-4" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb222-5"><a href="survey-data-analysis.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income =</span> <span class="fu">ifelse</span>(INCWAGE <span class="sc">&lt;=</span> <span class="dv">0</span>, <span class="cn">NA</span>, INCWAGE),</span>
<span id="cb222-6"><a href="survey-data-analysis.html#cb222-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013)) <span class="sc">%&gt;%</span></span>
<span id="cb222-7"><a href="survey-data-analysis.html#cb222-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb222-8"><a href="survey-data-analysis.html#cb222-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb222-9"><a href="survey-data-analysis.html#cb222-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb222-10"><a href="survey-data-analysis.html#cb222-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(met_name)<span class="sc">%&gt;%</span></span>
<span id="cb222-11"><a href="survey-data-analysis.html#cb222-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_wage =</span> <span class="fu">survey_median</span>(income, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span>  </span>
<span id="cb222-12"><a href="survey-data-analysis.html#cb222-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb222-13"><a href="survey-data-analysis.html#cb222-13" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">&quot;latex&quot;</span>,</span>
<span id="cb222-14"><a href="survey-data-analysis.html#cb222-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">digits =</span> <span class="dv">0</span>,</span>
<span id="cb222-15"><a href="survey-data-analysis.html#cb222-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="st">&quot;Median Wages in Texas MSAs&quot;</span>,</span>
<span id="cb222-16"><a href="survey-data-analysis.html#cb222-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">align =</span> <span class="st">&#39;c&#39;</span>,</span>
<span id="cb222-17"><a href="survey-data-analysis.html#cb222-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">col.names =</span><span class="fu">c</span>(<span class="st">&quot;MSA Name&quot;</span>, <span class="st">&quot;Median Wage&quot;</span>, <span class="st">&quot;Median Wage SE&quot;</span>))</span></code></pre></div>
<p>Which is OK, but there are other ways to make tables for reports. The <code>gt</code> package <span class="citation">(<a href="#ref-Iannone2021" role="doc-biblioref">Iannone, Cheng, and Schloerke 2021</a>)</span> is built using tidyverse principles, and build tables in much the same way that <code>ggplot</code> builds plots, and fits easily into a dplyr workflow. Here, I use <code>gt</code> to produce a similar table to that from <code>knitr::kable</code> from above.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="survey-data-analysis.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt, <span class="at">quietly =</span> T)</span>
<span id="cb223-2"><a href="survey-data-analysis.html#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="survey-data-analysis.html#cb223-3" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb223-4"><a href="survey-data-analysis.html#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb223-5"><a href="survey-data-analysis.html#cb223-5" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb223-6"><a href="survey-data-analysis.html#cb223-6" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb223-7"><a href="survey-data-analysis.html#cb223-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income =</span> <span class="fu">ifelse</span>(INCWAGE <span class="sc">&lt;=</span> <span class="dv">0</span>, <span class="cn">NA</span>, INCWAGE),</span>
<span id="cb223-8"><a href="survey-data-analysis.html#cb223-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013)) <span class="sc">%&gt;%</span></span>
<span id="cb223-9"><a href="survey-data-analysis.html#cb223-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb223-10"><a href="survey-data-analysis.html#cb223-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb223-11"><a href="survey-data-analysis.html#cb223-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb223-12"><a href="survey-data-analysis.html#cb223-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(met_name)<span class="sc">%&gt;%</span></span>
<span id="cb223-13"><a href="survey-data-analysis.html#cb223-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_wage =</span> <span class="fu">survey_median</span>(income, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span>  </span>
<span id="cb223-14"><a href="survey-data-analysis.html#cb223-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()<span class="sc">%&gt;%</span></span>
<span id="cb223-15"><a href="survey-data-analysis.html#cb223-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb223-16"><a href="survey-data-analysis.html#cb223-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">&quot;Median Wages in Texas MSAs&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb223-17"><a href="survey-data-analysis.html#cb223-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(<span class="at">met_name =</span> <span class="st">&quot;MSA Name&quot;</span>,</span>
<span id="cb223-18"><a href="survey-data-analysis.html#cb223-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">median_wage =</span> <span class="st">&quot;Median Wage&quot;</span>,</span>
<span id="cb223-19"><a href="survey-data-analysis.html#cb223-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">median_wage_se =</span> <span class="st">&quot;Median Wage SE&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb223-20"><a href="survey-data-analysis.html#cb223-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>( median_wage,  median_wage_se), </span>
<span id="cb223-21"><a href="survey-data-analysis.html#cb223-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">decimals =</span> <span class="dv">0</span>, <span class="at">use_seps =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div id="zlgvmykvcq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#zlgvmykvcq .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zlgvmykvcq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zlgvmykvcq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zlgvmykvcq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zlgvmykvcq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zlgvmykvcq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zlgvmykvcq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zlgvmykvcq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zlgvmykvcq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zlgvmykvcq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zlgvmykvcq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zlgvmykvcq .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#zlgvmykvcq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zlgvmykvcq .gt_from_md > :first-child {
  margin-top: 0;
}

#zlgvmykvcq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zlgvmykvcq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zlgvmykvcq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#zlgvmykvcq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zlgvmykvcq .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#zlgvmykvcq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zlgvmykvcq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zlgvmykvcq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zlgvmykvcq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zlgvmykvcq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zlgvmykvcq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#zlgvmykvcq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zlgvmykvcq .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#zlgvmykvcq .gt_left {
  text-align: left;
}

#zlgvmykvcq .gt_center {
  text-align: center;
}

#zlgvmykvcq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zlgvmykvcq .gt_font_normal {
  font-weight: normal;
}

#zlgvmykvcq .gt_font_bold {
  font-weight: bold;
}

#zlgvmykvcq .gt_font_italic {
  font-style: italic;
}

#zlgvmykvcq .gt_super {
  font-size: 65%;
}

#zlgvmykvcq .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Median Wages in Texas MSAs</th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">MSA Name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Median Wage</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Median Wage SE</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">Amarillo, TX</td>
<td class="gt_row gt_right">33,000</td>
<td class="gt_row gt_right">1,529</td></tr>
    <tr><td class="gt_row gt_center">Austin-Round Rock, TX</td>
<td class="gt_row gt_right">42,000</td>
<td class="gt_row gt_right">1,020</td></tr>
    <tr><td class="gt_row gt_center">Beaumont-Port Arthur, TX</td>
<td class="gt_row gt_right">40,000</td>
<td class="gt_row gt_right">1,784</td></tr>
    <tr><td class="gt_row gt_center">Brownsville-Harlingen, TX</td>
<td class="gt_row gt_right">25,200</td>
<td class="gt_row gt_right">1,020</td></tr>
    <tr><td class="gt_row gt_center">College Station-Bryan, TX</td>
<td class="gt_row gt_right">30,000</td>
<td class="gt_row gt_right">1,529</td></tr>
    <tr><td class="gt_row gt_center">Corpus Christi, TX</td>
<td class="gt_row gt_right">34,000</td>
<td class="gt_row gt_right">1,428</td></tr>
  </tbody>
  
  
</table>
</div>
<p>In general, the <code>gt</code> tables are much easier to make look nice, compared to basic tables, because they’re much more customizable. The <code>gtsummary</code> package extends the table functionality by combining the summary functions like <code>dplyr</code> with the table structures of <code>gt</code>. Additionally, it will recognize survey design objects so that information can also be integrated into your workflow. The <code>gtsummary</code> presents a more descriptive statistical summary of the variables included, and actually uses <code>dplyr</code> tools under the hood of the package.</p>
<p>In the code below, I first filter and mutate the IPUMS data to contain working age people who are employed, and who live in the six Texas cities featured in the examples above. I also create a new income variable that excludes all zero incomes, and drop levels of the <code>MET2013</code> variable that aren’t in the list I specified. This pipes into the survey design function from the <code>survey</code> package, which pipes into the <code>tbl_svysummary</code> function which summarizes income for each MSA. This function has a lot of options to specify its output, and I recommend you consult the examples at the author’s website<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="survey-data-analysis.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span></code></pre></div>
<pre><code>## #BlackLivesMatter</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="survey-data-analysis.html#cb226-1" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb226-2"><a href="survey-data-analysis.html#cb226-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(EMPSTAT <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb226-3"><a href="survey-data-analysis.html#cb226-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb226-4"><a href="survey-data-analysis.html#cb226-4" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>, </span>
<span id="cb226-5"><a href="survey-data-analysis.html#cb226-5" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11100</span>, <span class="dv">12420</span>, <span class="dv">13140</span>, <span class="dv">15180</span>, <span class="dv">17780</span>, <span class="dv">18580</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb226-6"><a href="survey-data-analysis.html#cb226-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income =</span> <span class="fu">ifelse</span>(INCWAGE <span class="sc">&lt;=</span> <span class="dv">0</span>, <span class="cn">NA</span>, INCWAGE),</span>
<span id="cb226-7"><a href="survey-data-analysis.html#cb226-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013))<span class="sc">%&gt;%</span></span>
<span id="cb226-8"><a href="survey-data-analysis.html#cb226-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(met_name,  income, CLUSTER, STRATA, PERWT)<span class="sc">%&gt;%</span></span>
<span id="cb226-9"><a href="survey-data-analysis.html#cb226-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()<span class="sc">%&gt;%</span></span>
<span id="cb226-10"><a href="survey-data-analysis.html#cb226-10" aria-hidden="true" tabindex="-1"></a>  survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span> CLUSTER,</span>
<span id="cb226-11"><a href="survey-data-analysis.html#cb226-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="sc">~</span> STRATA,</span>
<span id="cb226-12"><a href="survey-data-analysis.html#cb226-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span> PERWT,</span>
<span id="cb226-13"><a href="survey-data-analysis.html#cb226-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb226-14"><a href="survey-data-analysis.html#cb226-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">tbl_svysummary</span>(<span class="at">by =</span> <span class="st">&quot;met_name&quot;</span>,</span>
<span id="cb226-15"><a href="survey-data-analysis.html#cb226-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">missing =</span> <span class="st">&quot;no&quot;</span>,</span>
<span id="cb226-16"><a href="survey-data-analysis.html#cb226-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">include =</span> <span class="fu">c</span>(met_name, income), </span>
<span id="cb226-17"><a href="survey-data-analysis.html#cb226-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="fu">list</span>(<span class="at">income =</span> <span class="st">&quot;Median Wage&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb226-18"><a href="survey-data-analysis.html#cb226-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_hux_table</span>()</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-105">
<caption style="caption-side: top; text-align: center;"><span id="tab:unnamed-chunk-105">Table 4.1: </span> </caption><col><col><col><col><col><col><col><tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><strong>Characteristic</strong></p>
</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><strong>Amarillo, TX</strong>, N = 114,201</p>
</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><strong>Austin-Round Rock, TX</strong>, N = 1,193,654</p>
</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><strong>Beaumont-Port Arthur, TX</strong>, N = 163,936</p>
</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><strong>Brownsville-Harlingen, TX</strong>, N = 161,922</p>
</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><strong>College Station-Bryan, TX</strong>, N = 111,576</p>
</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><strong>Corpus Christi, TX</strong>, N = 208,801</p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Median Wage</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">34,000 (19,200, 56,000)</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">43,000 (24,000, 75,000)</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">40,000 (20,000, 67,000)</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">26,000 (14,000, 47,000)</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">30,000 (14,000, 51,111)</td><td style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">35,000 (20,000, 58,000)</td></tr>
<tr>
<td colspan="7" style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">Median (IQR)</td></tr>
</table>

<p class="comment">
<div id="how-this-differs-from-simple-random-sampling" class="section level3" number="4.10.1">
<h3><span class="header-section-number">4.10.1</span> How this differs from simple random sampling</h3>
<p>So the big question I often get from students is “Do I really need to weight my analysis?” and of course, I say, “Of course!” Weights don’t just inflate your data to the population, they serve a very important role in making sure your sample data aren’t biased in their scope. Bias can enter into survey data in many forms, but nonresponse bias can dramatically affect population based estimates if key segments of our target population respond at low rates. Surveys will often deal with this by rigorous data collection strategies, but often the survey designers have to account for the added probability of nonresponse by modification of their basic weights. <span class="citation"><a href="#ref-Lohr2019" role="doc-biblioref">Lohr</a> (<a href="#ref-Lohr2019" role="doc-biblioref">2019</a>)</span> describes how this is done using a variety of methods including raking and post stratification, which typically separate the sample into subdivisions based on one or more demographic characteristic and produce weights based on how the sample deviates from the population composition. These methods are robust and are commonly used in large national surveys including the Behavioral Risk Factor Surveillance system (BRFSS).</p>
<p>Other reasons for weighting and why it matters are oversampling. Many surveys will do this in their data collection because an important element of their target population may be small in overall size, so they will sample more respondents from that population subgroup than their proportion in the larger population would predict. For example, if a survey wanted to get detailed data on recent refugees to a country, and this group is small, say .1 percent of the overall population, they may design their study to have 10% of their survey respondents be refugees. This oversampling can be accounted for in the survey weights so the additional respondents are down-weighted to represent their fraction of the target population, while still allowing the researchers to get a large sample from this group. Surveys such as the Early Childhood Longitudinal Surveys and the National Longitudinal Study of Adolescent to Adult Health (AddHealth) routinely over-sample specific groups. For example the AddHealth over-samples black adolescents with college educated parents, Cuban, Puerto Rican, Chinese, and physically disabled adolescents.</p>
</div>
<div id="how-do-weights-affect-our-estimates" class="section level3" number="4.10.2">
<h3><span class="header-section-number">4.10.2</span> How do weights affect our estimates?</h3>
<p>In the code example below, I illustrate how not including sample weights affects the estimates generated. This in effect is how traditional statistical analysis assuming random sampling would do things. So in order to compare the weighted estimates to the unweighted estimates, all we need to do is use a non-survey design oriented method to produce our estimate, and compare it to the survey design oriented method. Note that many surveys are designed to be <em>self-weighting</em>, so weights are not provided nor necessary, again, read the documentation for your specific survey for what it recommends.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="survey-data-analysis.html#cb227-1" aria-hidden="true" tabindex="-1"></a>srs<span class="ot">&lt;-</span>ipums <span class="sc">%&gt;%</span></span>
<span id="cb227-2"><a href="survey-data-analysis.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb227-3"><a href="survey-data-analysis.html#cb227-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb227-4"><a href="survey-data-analysis.html#cb227-4" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb227-5"><a href="survey-data-analysis.html#cb227-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">employed =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(.<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Employed&quot;</span>,</span>
<span id="cb227-6"><a href="survey-data-analysis.html#cb227-6" aria-hidden="true" tabindex="-1"></a>                              .<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;Unemployed&quot;</span> )),</span>
<span id="cb227-7"><a href="survey-data-analysis.html#cb227-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013)) <span class="sc">%&gt;%</span></span>
<span id="cb227-8"><a href="survey-data-analysis.html#cb227-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(met_name)<span class="sc">%&gt;%</span></span>
<span id="cb227-9"><a href="survey-data-analysis.html#cb227-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">emp_rate =</span> <span class="fu">mean</span>(<span class="fu">I</span>(employed)<span class="sc">==</span><span class="st">&quot;Employed&quot;</span>),</span>
<span id="cb227-10"><a href="survey-data-analysis.html#cb227-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">emp_rate_se =</span> <span class="fu">sd</span>(<span class="fu">I</span>(employed)<span class="sc">==</span><span class="st">&quot;Employed&quot;</span>)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>()))<span class="sc">%&gt;%</span></span>
<span id="cb227-11"><a href="survey-data-analysis.html#cb227-11" aria-hidden="true" tabindex="-1"></a>   <span class="co"># pivot_wider(id = met_name,</span></span>
<span id="cb227-12"><a href="survey-data-analysis.html#cb227-12" aria-hidden="true" tabindex="-1"></a>   <span class="co">#            names_from = employed,</span></span>
<span id="cb227-13"><a href="survey-data-analysis.html#cb227-13" aria-hidden="true" tabindex="-1"></a>   <span class="co">#            values_from = c(emp_rate, emp_rate_se) ) %&gt;%</span></span>
<span id="cb227-14"><a href="survey-data-analysis.html#cb227-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb227-15"><a href="survey-data-analysis.html#cb227-15" aria-hidden="true" tabindex="-1"></a>srs<span class="sc">$</span>estimate<span class="ot">&lt;-</span><span class="st">&quot;Unweighted&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="survey-data-analysis.html#cb228-1" aria-hidden="true" tabindex="-1"></a>surv.est<span class="ot">&lt;-</span>ipums <span class="sc">%&gt;%</span></span>
<span id="cb228-2"><a href="survey-data-analysis.html#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb228-3"><a href="survey-data-analysis.html#cb228-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>, </span>
<span id="cb228-4"><a href="survey-data-analysis.html#cb228-4" aria-hidden="true" tabindex="-1"></a>         MET2013 <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb228-5"><a href="survey-data-analysis.html#cb228-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">employed =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(.<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Employed&quot;</span>,</span>
<span id="cb228-6"><a href="survey-data-analysis.html#cb228-6" aria-hidden="true" tabindex="-1"></a>                              .<span class="sc">$</span>EMPSTAT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;Unemployed&quot;</span> )),</span>
<span id="cb228-7"><a href="survey-data-analysis.html#cb228-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">met_name =</span> haven<span class="sc">::</span><span class="fu">as_factor</span>(MET2013)) <span class="sc">%&gt;%</span></span>
<span id="cb228-8"><a href="survey-data-analysis.html#cb228-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb228-9"><a href="survey-data-analysis.html#cb228-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb228-10"><a href="survey-data-analysis.html#cb228-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb228-11"><a href="survey-data-analysis.html#cb228-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(met_name)<span class="sc">%&gt;%</span></span>
<span id="cb228-12"><a href="survey-data-analysis.html#cb228-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">emp_rate =</span> <span class="fu">survey_mean</span>(<span class="fu">I</span>(employed)<span class="sc">==</span><span class="st">&quot;Employed&quot;</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb228-13"><a href="survey-data-analysis.html#cb228-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rename(emp_rate_surv = emp_rate, emp_rate_se_surv = emp_rate_se)%&gt;%</span></span>
<span id="cb228-14"><a href="survey-data-analysis.html#cb228-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb228-15"><a href="survey-data-analysis.html#cb228-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-16"><a href="survey-data-analysis.html#cb228-16" aria-hidden="true" tabindex="-1"></a>surv.est<span class="sc">$</span>estimate<span class="ot">&lt;-</span><span class="st">&quot;Weighted&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="survey-data-analysis.html#cb229-1" aria-hidden="true" tabindex="-1"></a>merged <span class="ot">&lt;-</span> <span class="fu">rbind</span>(srs, surv.est)</span>
<span id="cb229-2"><a href="survey-data-analysis.html#cb229-2" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>merged<span class="sc">%&gt;%</span></span>
<span id="cb229-3"><a href="survey-data-analysis.html#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> emp_rate, <span class="at">x =</span> met_name , <span class="at">color =</span> estimate))<span class="sc">+</span></span>
<span id="cb229-4"><a href="survey-data-analysis.html#cb229-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb229-5"><a href="survey-data-analysis.html#cb229-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">cex=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb229-6"><a href="survey-data-analysis.html#cb229-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> met_name),</span>
<span id="cb229-7"><a href="survey-data-analysis.html#cb229-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb229-8"><a href="survey-data-analysis.html#cb229-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)<span class="sc">+</span></span>
<span id="cb229-9"><a href="survey-data-analysis.html#cb229-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>( <span class="at">name =</span> <span class="st">&quot;Estimate Type&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb229-10"><a href="survey-data-analysis.html#cb229-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;MSA&quot;</span>, </span>
<span id="cb229-11"><a href="survey-data-analysis.html#cb229-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Employment Rate Estimate&quot;</span>,</span>
<span id="cb229-12"><a href="survey-data-analysis.html#cb229-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Employment rate in Texas MSAs&quot;</span>,</span>
<span id="cb229-13"><a href="survey-data-analysis.html#cb229-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Rate estimates&quot;</span>)<span class="sc">+</span></span>
<span id="cb229-14"><a href="survey-data-analysis.html#cb229-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb229-15"><a href="survey-data-analysis.html#cb229-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-16"><a href="survey-data-analysis.html#cb229-16" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span>merged<span class="sc">%&gt;%</span></span>
<span id="cb229-17"><a href="survey-data-analysis.html#cb229-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> emp_rate_se, <span class="at">x =</span> met_name , <span class="at">color =</span> estimate))<span class="sc">+</span></span>
<span id="cb229-18"><a href="survey-data-analysis.html#cb229-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb229-19"><a href="survey-data-analysis.html#cb229-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">cex=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb229-20"><a href="survey-data-analysis.html#cb229-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> met_name),</span>
<span id="cb229-21"><a href="survey-data-analysis.html#cb229-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb229-22"><a href="survey-data-analysis.html#cb229-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>()<span class="sc">%&gt;%</span></span>
<span id="cb229-23"><a href="survey-data-analysis.html#cb229-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;MSA&quot;</span>, </span>
<span id="cb229-24"><a href="survey-data-analysis.html#cb229-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Standard Error&quot;</span>,</span>
<span id="cb229-25"><a href="survey-data-analysis.html#cb229-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb229-26"><a href="survey-data-analysis.html#cb229-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Standard error of estimates&quot;</span>)<span class="sc">+</span></span>
<span id="cb229-27"><a href="survey-data-analysis.html#cb229-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb229-28"><a href="survey-data-analysis.html#cb229-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-29"><a href="survey-data-analysis.html#cb229-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb229-30"><a href="survey-data-analysis.html#cb229-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-31"><a href="survey-data-analysis.html#cb229-31" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-108-1.png" width="672" />
We see that the difference in the weighted and unweighted estimates do vary by MSA, as do the standard errors of the estimates, with the survey-design calculated standard errors nearly always being higher than those assuming simple random sampling. If our data came from a survey with more extreme oversampling we would likely see larger differences in these estimates, and it is generally advisable to include both weights and survey design elements in all analysis of complex survey data.</p>
</p>
</div>
</div>
<div id="basic-statistical-testing-on-survey-data." class="section level2" number="4.11">
<h2><span class="header-section-number">4.11</span> Basic statistical testing on survey data.</h2>
<p>To perform basic bivariate statistical tests for frequency tables, the <code>srvyr::svychisq</code> and <code>survey::svy_chisq</code> are the primary tools you need. These will test for basic independence among rows and columns of a frequency table. Below is an example on how you would test for independence of labor force participation and gender in the IPUMS ACS data.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="survey-data-analysis.html#cb230-1" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb230-2"><a href="survey-data-analysis.html#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb230-3"><a href="survey-data-analysis.html#cb230-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>) <span class="sc">%&gt;%</span></span>
<span id="cb230-4"><a href="survey-data-analysis.html#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lab_force_part =</span> <span class="fu">ifelse</span> (<span class="at">test =</span> EMPSTAT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb230-5"><a href="survey-data-analysis.html#cb230-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yes =</span> <span class="dv">1</span>,</span>
<span id="cb230-6"><a href="survey-data-analysis.html#cb230-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">no =</span> <span class="dv">0</span>), </span>
<span id="cb230-7"><a href="survey-data-analysis.html#cb230-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender =</span> <span class="fu">ifelse</span>(<span class="at">test =</span> SEX <span class="sc">==</span><span class="dv">1</span>,</span>
<span id="cb230-8"><a href="survey-data-analysis.html#cb230-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yes =</span> <span class="st">&quot;Male&quot;</span>,</span>
<span id="cb230-9"><a href="survey-data-analysis.html#cb230-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">no =</span> <span class="st">&quot;Female&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb230-10"><a href="survey-data-analysis.html#cb230-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb230-11"><a href="survey-data-analysis.html#cb230-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb230-12"><a href="survey-data-analysis.html#cb230-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb230-13"><a href="survey-data-analysis.html#cb230-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svychisq</span>(<span class="sc">~</span>lab_force_part<span class="sc">+</span>gender,</span>
<span id="cb230-14"><a href="survey-data-analysis.html#cb230-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">design =</span> .)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s X^2: Rao &amp; Scott adjustment
## 
## data:  NextMethod()
## F = 1955.4, ndf = 1, ddf = 172976, p-value &lt; 0.00000000000000022</code></pre>
<p>The output above is for the survey adjusted chi square test <span class="citation">(<a href="#ref-rao_chi-squared_1984" role="doc-biblioref">Rao and Scott 1984</a>)</span>, which is actually calculated as an F-test in this case. We see a large F-test value, and a very small p value, which indicates that men and women have different labor force participation rates. Using our workflow from above, we can calculate the actual rates as well.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="survey-data-analysis.html#cb232-1" aria-hidden="true" tabindex="-1"></a>ipums <span class="sc">%&gt;%</span></span>
<span id="cb232-2"><a href="survey-data-analysis.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EMPSTAT <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb232-3"><a href="survey-data-analysis.html#cb232-3" aria-hidden="true" tabindex="-1"></a>         AGE <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> AGE <span class="sc">&lt;=</span> <span class="dv">65</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-4"><a href="survey-data-analysis.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lab_force_part =</span> <span class="fu">ifelse</span> (<span class="at">test =</span> EMPSTAT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb232-5"><a href="survey-data-analysis.html#cb232-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yes =</span> <span class="dv">1</span>,</span>
<span id="cb232-6"><a href="survey-data-analysis.html#cb232-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">no =</span> <span class="dv">0</span>), </span>
<span id="cb232-7"><a href="survey-data-analysis.html#cb232-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender =</span> <span class="fu">ifelse</span>(<span class="at">test =</span> SEX <span class="sc">==</span><span class="dv">1</span>,</span>
<span id="cb232-8"><a href="survey-data-analysis.html#cb232-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yes =</span> <span class="st">&quot;Male&quot;</span>,</span>
<span id="cb232-9"><a href="survey-data-analysis.html#cb232-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">no =</span> <span class="st">&quot;Female&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb232-10"><a href="survey-data-analysis.html#cb232-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> CLUSTER,</span>
<span id="cb232-11"><a href="survey-data-analysis.html#cb232-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> STRATA,</span>
<span id="cb232-12"><a href="survey-data-analysis.html#cb232-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> PERWT) <span class="sc">%&gt;%</span></span>
<span id="cb232-13"><a href="survey-data-analysis.html#cb232-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gender)<span class="sc">%&gt;%</span></span>
<span id="cb232-14"><a href="survey-data-analysis.html#cb232-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">lf_part_rate =</span> <span class="fu">survey_mean</span>(lab_force_part, <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span>  </span>
<span id="cb232-15"><a href="survey-data-analysis.html#cb232-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()<span class="sc">%&gt;%</span></span>
<span id="cb232-16"><a href="survey-data-analysis.html#cb232-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb232-17"><a href="survey-data-analysis.html#cb232-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">&quot;Labor Force Participation Rates in Texas&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb232-18"><a href="survey-data-analysis.html#cb232-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(<span class="at">gender =</span> <span class="st">&quot;Gender&quot;</span>,</span>
<span id="cb232-19"><a href="survey-data-analysis.html#cb232-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lf_part_rate =</span> <span class="st">&quot;Labor Force Participation Rate&quot;</span>,</span>
<span id="cb232-20"><a href="survey-data-analysis.html#cb232-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">lf_part_rate_se =</span> <span class="st">&quot;SE&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb232-21"><a href="survey-data-analysis.html#cb232-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>( lf_part_rate,  lf_part_rate_se), </span>
<span id="cb232-22"><a href="survey-data-analysis.html#cb232-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">decimals =</span> <span class="dv">3</span>, <span class="at">use_seps =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div id="mmvvgmfvjx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#mmvvgmfvjx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mmvvgmfvjx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mmvvgmfvjx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mmvvgmfvjx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mmvvgmfvjx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mmvvgmfvjx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mmvvgmfvjx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mmvvgmfvjx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mmvvgmfvjx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mmvvgmfvjx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mmvvgmfvjx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mmvvgmfvjx .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#mmvvgmfvjx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mmvvgmfvjx .gt_from_md > :first-child {
  margin-top: 0;
}

#mmvvgmfvjx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mmvvgmfvjx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mmvvgmfvjx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#mmvvgmfvjx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mmvvgmfvjx .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#mmvvgmfvjx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mmvvgmfvjx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mmvvgmfvjx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mmvvgmfvjx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mmvvgmfvjx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mmvvgmfvjx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#mmvvgmfvjx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mmvvgmfvjx .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#mmvvgmfvjx .gt_left {
  text-align: left;
}

#mmvvgmfvjx .gt_center {
  text-align: center;
}

#mmvvgmfvjx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mmvvgmfvjx .gt_font_normal {
  font-weight: normal;
}

#mmvvgmfvjx .gt_font_bold {
  font-weight: bold;
}

#mmvvgmfvjx .gt_font_italic {
  font-style: italic;
}

#mmvvgmfvjx .gt_super {
  font-size: 65%;
}

#mmvvgmfvjx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Labor Force Participation Rates in Texas</th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Labor Force Participation Rate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">SE</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Female</td>
<td class="gt_row gt_right">0.674</td>
<td class="gt_row gt_right">0.002</td></tr>
    <tr><td class="gt_row gt_left">Male</td>
<td class="gt_row gt_right">0.797</td>
<td class="gt_row gt_right">0.002</td></tr>
  </tbody>
  
  
</table>
</div>
<p>So we see that males have a much higher labor force participation rate, compared to females, and this puts the differences that we observed from the chi square test into better context.</p>
<div id="regression-and-survey-design" class="section level3" number="4.11.1">
<h3><span class="header-section-number">4.11.1</span> Regression and survey design</h3>
<p>The design of our surveys affect the most basic estimates we do, and likewise, the design affects the more complicated analysis as well. Regression models are the work horse of social science research and we will spend a significant amount of the chapters that follow on thorough inspection of them. In the context of this chapter, I felt like I need to show both how to include survey design in a regression model and illustrate that weighting and survey design matters in terms of the output from out models. This section is <em>NOT</em> a total coverage of these models, and is at best a short example. This example will go in a different direction and use data from the Demographic and Health Survey instead of the ACS.</p>
<p>The Demographic and Health Survey (DHS) data have been collected since the mid 1980’s in over 90 countries around the world, and the DHS provides a public model data set that represents data on real households, without a specific national context. These data are provided to let people learn how to use the data before applying for access. The model data can be downloaded freely from the DHS[^surveydata-3] as a SAS or STATA format, or from my Github site[^surveydata-4] for this book. Below, I will read in the data from Github and recode child growth stunting relative to the WHO standard as an outcome[^surveydata-5] , and child age, rural residence and gender as predictors.</p>
<p>The DHS household file is arrayed with a column for every child, so we must reshape the data from wide to long format using <code>pivot_longer</code> for the variables for child height relative to the WHO standard (<code>hc70</code>), child gender <code>hc27</code>, and child age <code>hc1</code>. The other variables are common to the household, so we do not have to reshape them (per the <code>cols=</code> line below). We then recode the outcome and the predictors for our regression example.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="survey-data-analysis.html#cb233-1" aria-hidden="true" tabindex="-1"></a>dhs_model_hh <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb233-2"><a href="survey-data-analysis.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">url</span>(<span class="st">&quot;https://github.com/coreysparks/data/blob/master/dhs_model_hh.rds?raw=true&quot;</span>)</span>
<span id="cb233-3"><a href="survey-data-analysis.html#cb233-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb233-4"><a href="survey-data-analysis.html#cb233-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-5"><a href="survey-data-analysis.html#cb233-5" aria-hidden="true" tabindex="-1"></a>dhs_model_hh_sub <span class="ot">&lt;-</span> dhs_model_hh<span class="sc">%&gt;%</span></span>
<span id="cb233-6"><a href="survey-data-analysis.html#cb233-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hc27_01<span class="sc">:</span>hc27_20, </span>
<span id="cb233-7"><a href="survey-data-analysis.html#cb233-7" aria-hidden="true" tabindex="-1"></a>         hc70_01<span class="sc">:</span>hc70_20, </span>
<span id="cb233-8"><a href="survey-data-analysis.html#cb233-8" aria-hidden="true" tabindex="-1"></a>         hc1_01<span class="sc">:</span>hc1_20,</span>
<span id="cb233-9"><a href="survey-data-analysis.html#cb233-9" aria-hidden="true" tabindex="-1"></a>         hv021, hv025, hv270, hv005, hv021, hv022)<span class="sc">%&gt;%</span></span>
<span id="cb233-10"><a href="survey-data-analysis.html#cb233-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>hv021, <span class="sc">-</span>hv025, <span class="sc">-</span>hv270, <span class="sc">-</span>hv005, <span class="sc">-</span>hv021, <span class="sc">-</span>hv022), </span>
<span id="cb233-11"><a href="survey-data-analysis.html#cb233-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to  =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;child&quot;</span>),</span>
<span id="cb233-12"><a href="survey-data-analysis.html#cb233-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb233-13"><a href="survey-data-analysis.html#cb233-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()<span class="sc">%&gt;%</span></span>
<span id="cb233-14"><a href="survey-data-analysis.html#cb233-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stunting =</span> car<span class="sc">::</span><span class="fu">Recode</span>(hc70, <span class="at">recodes =</span> <span class="st">&quot;-900:-200 = 1; 9996:9999 = NA; else = 0&quot;</span>),</span>
<span id="cb233-15"><a href="survey-data-analysis.html#cb233-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender =</span> <span class="fu">ifelse</span>(<span class="at">test =</span> hc27 <span class="sc">==</span> <span class="dv">1</span>, <span class="at">yes =</span> <span class="st">&quot;male&quot;</span>, <span class="at">no =</span> <span class="st">&quot;female&quot;</span>),</span>
<span id="cb233-16"><a href="survey-data-analysis.html#cb233-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">hh_wealth =</span> <span class="fu">as.factor</span>(hv270),</span>
<span id="cb233-17"><a href="survey-data-analysis.html#cb233-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> hc1,</span>
<span id="cb233-18"><a href="survey-data-analysis.html#cb233-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">age2 =</span> hc1<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb233-19"><a href="survey-data-analysis.html#cb233-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">rural =</span> <span class="fu">ifelse</span>(<span class="at">test =</span> hv025 <span class="sc">==</span><span class="dv">2</span>, <span class="at">yes =</span> <span class="st">&quot;rural&quot;</span>, <span class="at">no =</span> <span class="st">&quot;urban&quot;</span>),</span>
<span id="cb233-20"><a href="survey-data-analysis.html#cb233-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> hv005<span class="sc">/</span><span class="dv">1000000</span>,</span>
<span id="cb233-21"><a href="survey-data-analysis.html#cb233-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">psu =</span> hv021,</span>
<span id="cb233-22"><a href="survey-data-analysis.html#cb233-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">strata =</span> hv022)</span>
<span id="cb233-23"><a href="survey-data-analysis.html#cb233-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-24"><a href="survey-data-analysis.html#cb233-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-25"><a href="survey-data-analysis.html#cb233-25" aria-hidden="true" tabindex="-1"></a>dhs_model_des<span class="ot">&lt;-</span> dhs_model_hh_sub<span class="sc">%&gt;%</span></span>
<span id="cb233-26"><a href="survey-data-analysis.html#cb233-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">cluster =</span> psu,</span>
<span id="cb233-27"><a href="survey-data-analysis.html#cb233-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> strata,</span>
<span id="cb233-28"><a href="survey-data-analysis.html#cb233-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> wt,</span>
<span id="cb233-29"><a href="survey-data-analysis.html#cb233-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb233-30"><a href="survey-data-analysis.html#cb233-30" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dhs_model_des)</span></code></pre></div>
<pre><code>## Stratified Independent Sampling design (with replacement)
## Called via srvyr
## Probabilities:
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.1552  0.7872  1.2943  1.5297  2.0336  6.6422 
## Stratum Sizes: 
##             1   2  3  4   5  6   7   8   9  10  11 12  13 14  15  16  17 18  19
## obs        33 136 52 41 159 23 108 117 185 266 218 44 244 25 125 183 152 80 144
## design.PSU 33 136 52 41 159 23 108 117 185 266 218 44 244 25 125 183 152 80 144
## actual.PSU 33 136 52 41 159 23 108 117 185 266 218 44 244 25 125 183 152 80 144
##            20 21 22 23 24 25  26  27
## obs        62 83 74 74 73  6 122 124
## design.PSU 62 83 74 74 73  6 122 124
## actual.PSU 62 83 74 74 73  6 122 124
## Data variables:
##  [1] &quot;hv021&quot;     &quot;hv025&quot;     &quot;hv270&quot;     &quot;hv005&quot;     &quot;hv022&quot;     &quot;child&quot;    
##  [7] &quot;hc27&quot;      &quot;hc70&quot;      &quot;hc1&quot;       &quot;stunting&quot;  &quot;gender&quot;    &quot;hh_wealth&quot;
## [13] &quot;age&quot;       &quot;age2&quot;      &quot;rural&quot;     &quot;wt&quot;        &quot;psu&quot;       &quot;strata&quot;</code></pre>
<p>Just for completeness, I create a bar chart showing the percent stunted by the two main variables, gender and rural residence.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="survey-data-analysis.html#cb235-1" aria-hidden="true" tabindex="-1"></a>dhs_model_des<span class="sc">%&gt;%</span></span>
<span id="cb235-2"><a href="survey-data-analysis.html#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="fu">svyby</span>(<span class="at">formula =</span> <span class="sc">~</span> stunting,</span>
<span id="cb235-3"><a href="survey-data-analysis.html#cb235-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">by =</span> <span class="sc">~</span> gender <span class="sc">+</span> rural,</span>
<span id="cb235-4"><a href="survey-data-analysis.html#cb235-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">design =</span> .,</span>
<span id="cb235-5"><a href="survey-data-analysis.html#cb235-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">FUN =</span> svymean,</span>
<span id="cb235-6"><a href="survey-data-analysis.html#cb235-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">na.rm=</span>T))<span class="sc">%&gt;%</span></span>
<span id="cb235-7"><a href="survey-data-analysis.html#cb235-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb235-8"><a href="survey-data-analysis.html#cb235-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> gender, <span class="at">y  =</span> stunting, <span class="at">fill =</span> rural),</span>
<span id="cb235-9"><a href="survey-data-analysis.html#cb235-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb235-10"><a href="survey-data-analysis.html#cb235-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span></span>
<span id="cb235-11"><a href="survey-data-analysis.html#cb235-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Child Gender&quot;</span>, </span>
<span id="cb235-12"><a href="survey-data-analysis.html#cb235-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Percent Stunted&quot;</span>, </span>
<span id="cb235-13"><a href="survey-data-analysis.html#cb235-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Percent Stunted by Gender and Rural Residence&quot;</span>,</span>
<span id="cb235-14"><a href="survey-data-analysis.html#cb235-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;DHS Model Data&quot;</span>)<span class="sc">+</span></span>
<span id="cb235-15"><a href="survey-data-analysis.html#cb235-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<p>Now I estimate two logistic regression models for the stunting outcome. The first assumes random sampling and the second includes the full survey design information.</p>
<p>For the unweighted regular logistic regression, we use the <code>glm()</code> function with <code>family = binomial (link = "logit")</code>.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="survey-data-analysis.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb236-2"><a href="survey-data-analysis.html#cb236-2" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">&lt;-</span><span class="fu">glm</span>(stunting <span class="sc">~</span> age <span class="sc">+</span> age2 <span class="sc">+</span> rural <span class="sc">+</span> gender,</span>
<span id="cb236-3"><a href="survey-data-analysis.html#cb236-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> dhs_model_hh_sub,</span>
<span id="cb236-4"><a href="survey-data-analysis.html#cb236-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb236-5"><a href="survey-data-analysis.html#cb236-5" aria-hidden="true" tabindex="-1"></a>m1<span class="sc">%&gt;%</span></span>
<span id="cb236-6"><a href="survey-data-analysis.html#cb236-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept) -1.67     0.158      -10.6   4.47e-26
## 2 age          0.0976   0.0111       8.82  1.10e-18
## 3 age2        -0.00145  0.000176    -8.23  1.91e-16
## 4 ruralurban  -0.484    0.0934      -5.19  2.15e- 7
## 5 gendermale   0.0461   0.0837       0.551 5.82e- 1</code></pre>
<p>For the survey design model, you specify the design versus the data set name, otherwise the same code works just fine.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="survey-data-analysis.html#cb238-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> dhs_model_des<span class="sc">%&gt;%</span></span>
<span id="cb238-2"><a href="survey-data-analysis.html#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svyglm</span>(stunting <span class="sc">~</span> age <span class="sc">+</span> age2 <span class="sc">+</span>rural <span class="sc">+</span> gender,</span>
<span id="cb238-3"><a href="survey-data-analysis.html#cb238-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">design =</span> .,</span>
<span id="cb238-4"><a href="survey-data-analysis.html#cb238-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> binomial)</span></code></pre></div>
<pre><code>## Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="survey-data-analysis.html#cb240-1" aria-hidden="true" tabindex="-1"></a>m2<span class="sc">%&gt;%</span></span>
<span id="cb240-2"><a href="survey-data-analysis.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept) -1.77     0.180      -9.83   2.03e-22
## 2 age          0.108    0.0128      8.39   8.18e-17
## 3 age2        -0.00164  0.000209   -7.84   6.77e-15
## 4 ruralurban  -0.432    0.128      -3.38   7.25e- 4
## 5 gendermale   0.00938  0.103       0.0906 9.28e- 1</code></pre>
<p>There are lots of ways to make a table from a regression model, but <code>stargazer</code> <span class="citation">(<a href="#ref-stargazer" role="doc-biblioref">Hlavac 2018</a>)</span> is a simple way to present multiple models side by side.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="survey-data-analysis.html#cb242-1" aria-hidden="true" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(m1, m2,</span>
<span id="cb242-2"><a href="survey-data-analysis.html#cb242-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">keep.stat =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb242-3"><a href="survey-data-analysis.html#cb242-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">model.names =</span> F,</span>
<span id="cb242-4"><a href="survey-data-analysis.html#cb242-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">column.labels =</span> <span class="fu">c</span>(<span class="st">&quot;Unweighted model&quot;</span>, <span class="st">&quot;Weighted Model&quot;</span>),</span>
<span id="cb242-5"><a href="survey-data-analysis.html#cb242-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">&quot;latex&quot;</span>,</span>
<span id="cb242-6"><a href="survey-data-analysis.html#cb242-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">header =</span> <span class="cn">FALSE</span>, </span>
<span id="cb242-7"><a href="survey-data-analysis.html#cb242-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">style =</span> <span class="st">&quot;demography&quot;</span>,</span>
<span id="cb242-8"><a href="survey-data-analysis.html#cb242-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">title =</span> <span class="st">&quot;Output from Unweighted and Weighted Regression Models&quot;</span>)</span></code></pre></div>
<p>In this case, we see that the coefficient estimates are very similar between the two models, but the coefficient standard errors are all smaller in the unweighted model. This is commonly what you see in this situation, because the survey deign model is actually using <em>clustered standard errors</em> instead of asymptotic standard errors <span class="citation"><a href="#ref-ibragimov_inference_2016" role="doc-biblioref">Ibragimov and Müller</a> (<a href="#ref-ibragimov_inference_2016" role="doc-biblioref">2016</a>)</span>. While this example does not show an extreme difference, it is commonplace for t-statistics generated from clustered standard errors to have higher p-values than those using asymptotic standard errors. As a result, if the t-statistic is lower, and the p-value higher, you can easily get differences in your hypothesis tests for regression parameters. This is always something to be aware of as you analyze survey data.</p>
<p>[^surveydata-3] <a href="https://dhsprogram.com/data/model-datasets.cfm" class="uri">https://dhsprogram.com/data/model-datasets.cfm</a>
[^surveydata-4] <a href="https://github.com/coreysparks/dem-stats-book" class="uri">https://github.com/coreysparks/dem-stats-book</a>
[^surveydata-4] Per the <a href="https://dhsprogram.com/data/Guide-to-DHS-Statistics/index.cfm">guide to DHS statistics</a></p>
</div>
</div>
<div id="more-examples-from-the-cdc-brfss" class="section level2" number="4.12">
<h2><span class="header-section-number">4.12</span> More examples from the CDC BRFSS</h2>
<p>Below I illustrate the use of survey characteristics when conducting
descriptive analysis of a survey data set and a linear regression model
estimated from that data. For this example I am using 2016 CDC
Behavioral Risk Factor Surveillance System (BRFSS) SMART metro area
survey data. <a href="https://www.cdc.gov/brfss/smart/smart_2016.html">Link</a></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="survey-data-analysis.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load brfss</span></span>
<span id="cb243-2"><a href="survey-data-analysis.html#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<pre><code>## Loading required package: carData</code></pre>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="survey-data-analysis.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span></code></pre></div>
<pre><code>## 
## Please cite as:</code></pre>
<pre><code>##  Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.</code></pre>
<pre><code>##  R package version 5.2.2. https://CRAN.R-project.org/package=stargazer</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="survey-data-analysis.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb252-2"><a href="survey-data-analysis.html#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(questionr)</span>
<span id="cb252-3"><a href="survey-data-analysis.html#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="survey-data-analysis.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">&quot;https://github.com/coreysparks/data/blob/master/brfss_2017.Rdata?raw=true&quot;</span>))</span></code></pre></div>
<div id="fix-variable-names" class="section level3" number="4.12.1">
<h3><span class="header-section-number">4.12.1</span> Fix variable names</h3>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="survey-data-analysis.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The names in the data are very ugly, so I make them less ugly</span></span>
<span id="cb254-2"><a href="survey-data-analysis.html#cb254-2" aria-hidden="true" tabindex="-1"></a>nams<span class="ot">&lt;-</span><span class="fu">names</span>(brfss_17)</span>
<span id="cb254-3"><a href="survey-data-analysis.html#cb254-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nams, <span class="at">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;dispcode&quot; &quot;statere1&quot; &quot;safetime&quot; &quot;hhadult&quot;  &quot;genhlth&quot;  &quot;physhlth&quot;
##  [7] &quot;menthlth&quot; &quot;poorhlth&quot; &quot;hlthpln1&quot; &quot;persdoc2&quot;</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="survey-data-analysis.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we see some names are lower case, some are upper and some have a little _ in the first position. This is a nightmare.</span></span>
<span id="cb256-2"><a href="survey-data-analysis.html#cb256-2" aria-hidden="true" tabindex="-1"></a>newnames<span class="ot">&lt;-</span><span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;_&quot;</span>,<span class="at">replacement =</span>  <span class="st">&quot;&quot;</span>,<span class="at">x =</span>  nams))</span>
<span id="cb256-3"><a href="survey-data-analysis.html#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(brfss_17)<span class="ot">&lt;-</span>newnames</span></code></pre></div>
</div>
<div id="recoding-of-variables" class="section level3" number="4.12.2">
<h3><span class="header-section-number">4.12.2</span> Recoding of variables</h3>
<p>Be sure to always check your codebooks!</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="survey-data-analysis.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Poor or fair self rated health</span></span>
<span id="cb257-2"><a href="survey-data-analysis.html#cb257-2" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>badhealth<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>genhlth, <span class="at">recodes=</span><span class="st">&quot;4:5=1; 1:3=0; else=NA&quot;</span>)</span>
<span id="cb257-3"><a href="survey-data-analysis.html#cb257-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-4"><a href="survey-data-analysis.html#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="co">#sex</span></span>
<span id="cb257-5"><a href="survey-data-analysis.html#cb257-5" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>male<span class="ot">&lt;-</span><span class="fu">as.factor</span>(<span class="fu">ifelse</span>(brfss_17<span class="sc">$</span>sex<span class="sc">==</span><span class="dv">1</span>, <span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))</span>
<span id="cb257-6"><a href="survey-data-analysis.html#cb257-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-7"><a href="survey-data-analysis.html#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="co">#race/ethnicity</span></span>
<span id="cb257-8"><a href="survey-data-analysis.html#cb257-8" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>black<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>racegr3, <span class="at">recodes=</span><span class="st">&quot;2=1; 9=NA; else=0&quot;</span>)</span>
<span id="cb257-9"><a href="survey-data-analysis.html#cb257-9" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>white<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>racegr3, <span class="at">recodes=</span><span class="st">&quot;1=1; 9=NA; else=0&quot;</span>)</span>
<span id="cb257-10"><a href="survey-data-analysis.html#cb257-10" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>other<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>racegr3, <span class="at">recodes=</span><span class="st">&quot;3:4=1; 9=NA; else=0&quot;</span>)</span>
<span id="cb257-11"><a href="survey-data-analysis.html#cb257-11" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>hispanic<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>racegr3, <span class="at">recodes=</span><span class="st">&quot;5=1; 9=NA; else=0&quot;</span>)</span>
<span id="cb257-12"><a href="survey-data-analysis.html#cb257-12" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>race_eth<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>racegr3, <span class="at">recodes=</span><span class="st">&quot;1=&#39;nhwhite&#39;; 2=&#39;nh black&#39;; 3=&#39;nh other&#39;;4=&#39;nh multirace&#39;; 5=&#39;hispanic&#39;; else=NA&quot;</span>, <span class="at">as.factor =</span> T)</span>
<span id="cb257-13"><a href="survey-data-analysis.html#cb257-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-14"><a href="survey-data-analysis.html#cb257-14" aria-hidden="true" tabindex="-1"></a><span class="co">#insurance</span></span>
<span id="cb257-15"><a href="survey-data-analysis.html#cb257-15" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>ins<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>hlthpln1, <span class="at">recodes =</span><span class="st">&quot;7:9=NA; 1=1;2=0&quot;</span>)</span>
<span id="cb257-16"><a href="survey-data-analysis.html#cb257-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-17"><a href="survey-data-analysis.html#cb257-17" aria-hidden="true" tabindex="-1"></a><span class="co">#income grouping</span></span>
<span id="cb257-18"><a href="survey-data-analysis.html#cb257-18" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>inc<span class="ot">&lt;-</span><span class="fu">ifelse</span>(brfss_17<span class="sc">$</span>incomg<span class="sc">==</span><span class="dv">9</span>, <span class="cn">NA</span>, brfss_17<span class="sc">$</span>incomg)</span>
<span id="cb257-19"><a href="survey-data-analysis.html#cb257-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-20"><a href="survey-data-analysis.html#cb257-20" aria-hidden="true" tabindex="-1"></a><span class="co">#education level</span></span>
<span id="cb257-21"><a href="survey-data-analysis.html#cb257-21" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>educ<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>educa, <span class="at">recodes=</span><span class="st">&quot;1:2=&#39;0Prim&#39;; 3=&#39;1somehs&#39;; 4=&#39;2hsgrad&#39;; 5=&#39;3somecol&#39;; 6=&#39;4colgrad&#39;;9=NA&quot;</span>, <span class="at">as.factor=</span>T)</span>
<span id="cb257-22"><a href="survey-data-analysis.html#cb257-22" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>educ<span class="ot">&lt;-</span><span class="fu">relevel</span>(brfss_17<span class="sc">$</span>educ, <span class="at">ref=</span><span class="st">&#39;2hsgrad&#39;</span>)</span>
<span id="cb257-23"><a href="survey-data-analysis.html#cb257-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-24"><a href="survey-data-analysis.html#cb257-24" aria-hidden="true" tabindex="-1"></a><span class="co">#employment</span></span>
<span id="cb257-25"><a href="survey-data-analysis.html#cb257-25" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>employ<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>employ1, <span class="at">recodes=</span><span class="st">&quot;1:2=&#39;Employed&#39;; 2:6=&#39;nilf&#39;; 7=&#39;retired&#39;; 8=&#39;unable&#39;; else=NA&quot;</span>, <span class="at">as.factor=</span>T)</span>
<span id="cb257-26"><a href="survey-data-analysis.html#cb257-26" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>employ<span class="ot">&lt;-</span><span class="fu">relevel</span>(brfss_17<span class="sc">$</span>employ, <span class="at">ref=</span><span class="st">&#39;Employed&#39;</span>)</span>
<span id="cb257-27"><a href="survey-data-analysis.html#cb257-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-28"><a href="survey-data-analysis.html#cb257-28" aria-hidden="true" tabindex="-1"></a><span class="co">#marital status</span></span>
<span id="cb257-29"><a href="survey-data-analysis.html#cb257-29" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>marst<span class="ot">&lt;-</span><span class="fu">Recode</span>(brfss_17<span class="sc">$</span>marital, <span class="at">recodes=</span><span class="st">&quot;1=&#39;married&#39;; 2=&#39;divorced&#39;; 3=&#39;widowed&#39;; 4=&#39;separated&#39;; 5=&#39;nm&#39;;6=&#39;cohab&#39;; else=NA&quot;</span>, <span class="at">as.factor=</span>T)</span>
<span id="cb257-30"><a href="survey-data-analysis.html#cb257-30" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>marst<span class="ot">&lt;-</span><span class="fu">relevel</span>(brfss_17<span class="sc">$</span>marst, <span class="at">ref=</span><span class="st">&#39;married&#39;</span>)</span>
<span id="cb257-31"><a href="survey-data-analysis.html#cb257-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-32"><a href="survey-data-analysis.html#cb257-32" aria-hidden="true" tabindex="-1"></a><span class="co">#Age cut into intervals</span></span>
<span id="cb257-33"><a href="survey-data-analysis.html#cb257-33" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>agec<span class="ot">&lt;-</span><span class="fu">cut</span>(brfss_17<span class="sc">$</span>age80, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">39</span>,<span class="dv">59</span>,<span class="dv">79</span>,<span class="dv">99</span>))</span>
<span id="cb257-34"><a href="survey-data-analysis.html#cb257-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-35"><a href="survey-data-analysis.html#cb257-35" aria-hidden="true" tabindex="-1"></a><span class="co">#BMI, in the brfss_17a the bmi variable has 2 implied decimal places, so we must divide by 100 to get real bmi&#39;s</span></span>
<span id="cb257-36"><a href="survey-data-analysis.html#cb257-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-37"><a href="survey-data-analysis.html#cb257-37" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>bmi<span class="ot">&lt;-</span>brfss_17<span class="sc">$</span>bmi5<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb257-38"><a href="survey-data-analysis.html#cb257-38" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>obese<span class="ot">&lt;-</span><span class="fu">ifelse</span>(brfss_17<span class="sc">$</span>bmi<span class="sc">&gt;=</span><span class="dv">30</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="filter-cases" class="section level3" number="4.12.3">
<h3><span class="header-section-number">4.12.3</span> Filter cases</h3>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="survey-data-analysis.html#cb258-1" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="ot">&lt;-</span>brfss_17<span class="sc">%&gt;%</span></span>
<span id="cb258-2"><a href="survey-data-analysis.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sex<span class="sc">!=</span><span class="dv">9</span>, <span class="fu">is.na</span>(educ)<span class="sc">==</span>F)</span></code></pre></div>
</div>
<div id="analysis" class="section level3" number="4.12.4">
<h3><span class="header-section-number">4.12.4</span> Analysis</h3>
<p>First, we will do some descriptive analysis, such as means and cross
tabulations.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="survey-data-analysis.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co">#First we will do some tables</span></span>
<span id="cb259-2"><a href="survey-data-analysis.html#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Raw frequencies</span></span>
<span id="cb259-3"><a href="survey-data-analysis.html#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(brfss_17<span class="sc">$</span>badhealth, brfss_17<span class="sc">$</span>educ)</span></code></pre></div>
<pre><code>##    
##     2hsgrad 0Prim 1somehs 3somecol 4colgrad
##   0   42204  2657    5581    50592    87642
##   1   13533  2412    3843    11544     9177</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="survey-data-analysis.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co">#column percentages</span></span>
<span id="cb261-2"><a href="survey-data-analysis.html#cb261-2" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="sc">*</span><span class="fu">prop.table</span>(<span class="fu">table</span>(brfss_17<span class="sc">$</span>badhealth, brfss_17<span class="sc">$</span>educ), <span class="at">margin=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##    
##     2hsgrad 0Prim 1somehs 3somecol 4colgrad
##   0   75.72 52.42   59.22    81.42    90.52
##   1   24.28 47.58   40.78    18.58     9.48</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="survey-data-analysis.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co">#basic chi square test of independence</span></span>
<span id="cb263-2"><a href="survey-data-analysis.html#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="fu">table</span>(brfss_17<span class="sc">$</span>badhealth, brfss_17<span class="sc">$</span>educ))</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  table(brfss_17$badhealth, brfss_17$educ)
## X-squared = 12749, df = 4, p-value &lt;2e-16</code></pre>
<p>So basically all of these numbers are incorrect, since they all assume
random sampling. Now, we must tell R what the survey design is and what
the weight variable is, then we can re-do these so they are correct.</p>
</div>
<div id="create-a-survey-design-object" class="section level3" number="4.12.5">
<h3><span class="header-section-number">4.12.5</span> Create a survey design object</h3>
<p>Now we identify the survey design. <em>ids</em> = PSU identifers,
<em>strata</em>=strata identifiers, <em>weights</em>=sampling weights, <em>data</em>= the
data frame where these variables are located. Lastly, I only include
respondents with NON-MISSING case weights.</p>
<p>I first try to get only cities in the state of Texas by looking for “TX”
in the MSA’s name field in the data.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="survey-data-analysis.html#cb265-1" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>tx<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb265-2"><a href="survey-data-analysis.html#cb265-2" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="sc">$</span>tx[<span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">&quot;TX&quot;</span>, brfss_17<span class="sc">$</span>mmsaname)]<span class="ot">&lt;-</span><span class="dv">1</span></span></code></pre></div>
<p>Now I make the survey design object. You may be required to specify two
options here:</p>
<ol style="list-style-type: decimal">
<li><p><code>survey.lonely.psu</code> This means that some of the strata only have 1
PSU within them. This does not allow for within strata variance to
be calculated. So we often have to tell the computer to do something
here. Two valid options are “adjust,” to center the stratum at the
population mean rather than the stratum mean, and “average” to
replace the variance contribution of the stratum by the average
variance contribution across strata. (from ?surveyoptions)</p></li>
<li><p>Nesting of PSU within strata. By default, PSUs have numeric
identifiers that can overlap between strata. By specifying <code>nest=T</code>,
we tell R to re-lable the PSUs so they are unique across strata. If
your survey requires this, it will throw a warning message.</p></li>
</ol>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="survey-data-analysis.html#cb266-1" aria-hidden="true" tabindex="-1"></a>brfss_17<span class="ot">&lt;-</span>brfss_17<span class="sc">%&gt;%</span></span>
<span id="cb266-2"><a href="survey-data-analysis.html#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tx<span class="sc">==</span><span class="dv">1</span>, <span class="fu">is.na</span>(mmsawt)<span class="sc">==</span>F, <span class="fu">is.na</span>(badhealth)<span class="sc">==</span>F)</span>
<span id="cb266-3"><a href="survey-data-analysis.html#cb266-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-4"><a href="survey-data-analysis.html#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb266-5"><a href="survey-data-analysis.html#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">&quot;adjust&quot;</span>)</span>
<span id="cb266-6"><a href="survey-data-analysis.html#cb266-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-7"><a href="survey-data-analysis.html#cb266-7" aria-hidden="true" tabindex="-1"></a>des<span class="ot">&lt;-</span><span class="fu">svydesign</span>(<span class="at">ids=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">strata=</span><span class="sc">~</span>ststr, <span class="at">weights=</span><span class="sc">~</span>mmsawt, <span class="at">data =</span> brfss_17 )</span></code></pre></div>
<p>Simple weighted analysis Now , we re-do the analysis from above
using only weights:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="survey-data-analysis.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co">#counts</span></span>
<span id="cb267-2"><a href="survey-data-analysis.html#cb267-2" aria-hidden="true" tabindex="-1"></a>cat<span class="ot">&lt;-</span><span class="fu">wtd.table</span>(brfss_17<span class="sc">$</span>badhealth, brfss_17<span class="sc">$</span>educ, <span class="at">weights =</span> brfss_17<span class="sc">$</span>mmsawt)</span>
<span id="cb267-3"><a href="survey-data-analysis.html#cb267-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-4"><a href="survey-data-analysis.html#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="co">#proportions</span></span>
<span id="cb267-5"><a href="survey-data-analysis.html#cb267-5" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">wtd.table</span>(brfss_17<span class="sc">$</span>badhealth, brfss_17<span class="sc">$</span>educ, <span class="at">weights =</span> brfss_17<span class="sc">$</span>mmsawt), <span class="at">margin=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   2hsgrad  0Prim 1somehs 3somecol 4colgrad
## 0  0.7579 0.6003  0.6690   0.8348   0.9115
## 1  0.2421 0.3997  0.3310   0.1652   0.0885</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="survey-data-analysis.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compare that with the original, unweighted proportions</span></span>
<span id="cb269-2"><a href="survey-data-analysis.html#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(brfss_17<span class="sc">$</span>badhealth, brfss_17<span class="sc">$</span>educ), <span class="at">margin=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##    
##     2hsgrad 0Prim 1somehs 3somecol 4colgrad
##   0   0.709 0.569   0.623    0.780    0.884
##   1   0.291 0.431   0.377    0.220    0.116</code></pre>
<p>There <strong>are</strong> differences, notably that the prevalence of poor SRH is
<em>higher in the sample than the population</em>. This is important!</p>
<p>Let’s say we also want the standard errors of these percentages. This
can be found for a proportion by: <span class="math inline">\(s.e. (p)={\sqrt {p(1-p)} \over {n}}\)</span></p>
<p>So we need to get n and p, that’s easy:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="survey-data-analysis.html#cb271-1" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="fu">table</span>(<span class="fu">is.na</span>(brfss_17<span class="sc">$</span>badhealth)<span class="sc">==</span>F)</span>
<span id="cb271-2"><a href="survey-data-analysis.html#cb271-2" aria-hidden="true" tabindex="-1"></a>n</span></code></pre></div>
<p>TRUE
8535</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="survey-data-analysis.html#cb272-1" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">prop.table</span>(<span class="fu">wtd.table</span>(brfss_17<span class="sc">$</span>badhealth, brfss_17<span class="sc">$</span>educ, <span class="at">weights =</span> brfss_17<span class="sc">$</span>mmsawt), <span class="at">margin=</span><span class="dv">2</span>)</span>
<span id="cb272-2"><a href="survey-data-analysis.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(p)</span></code></pre></div>
<pre><code>          0      1</code></pre>
<p>2hsgrad 0.7579 0.2421
0Prim 0.6003 0.3997
1somehs 0.6690 0.3310
3somecol 0.8348 0.1652
4colgrad 0.9115 0.0885</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="survey-data-analysis.html#cb274-1" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">prop.table</span>(<span class="fu">wtd.table</span>(brfss_17<span class="sc">$</span>badhealth, brfss_17<span class="sc">$</span>male, <span class="at">weights =</span> brfss_17<span class="sc">$</span>mmsawt), <span class="at">margin=</span><span class="dv">2</span>)</span>
<span id="cb274-2"><a href="survey-data-analysis.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(p)</span></code></pre></div>
<pre><code>       0     1</code></pre>
<p>Female 0.791 0.209
Male 0.819 0.181</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="survey-data-analysis.html#cb276-1" aria-hidden="true" tabindex="-1"></a>se<span class="ot">&lt;-</span>(p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p))<span class="sc">/</span>n[<span class="dv">2</span>]</span>
<span id="cb276-2"><a href="survey-data-analysis.html#cb276-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-3"><a href="survey-data-analysis.html#cb276-3" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span></span>
<span id="cb276-4"><a href="survey-data-analysis.html#cb276-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-5"><a href="survey-data-analysis.html#cb276-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">data.frame</span>(<span class="at">proportion=</span>p, <span class="at">se=</span><span class="fu">sqrt</span>(se))[, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>)], <span class="at">format =</span> <span class="st">&quot;html&quot;</span>, <span class="at">caption =</span> <span class="st">&quot;Frequencies assuming random sampling&quot;</span>)</span></code></pre></div>
<p>Which shows us the errors in the estimates based on the weighted
proportions. That’s nice, but since we basically inflated the n to be
the population of the US, these standard errors are too small. This is
another example of using survey statistical methods, to get the right
standard error for a statistic.</p>
</div>
<div id="proper-survey-design-analysis" class="section level3" number="4.12.6">
<h3><span class="header-section-number">4.12.6</span> Proper survey design analysis</h3>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="survey-data-analysis.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Now consider the full sample design + weights</span></span>
<span id="cb277-2"><a href="survey-data-analysis.html#cb277-2" aria-hidden="true" tabindex="-1"></a>cat<span class="ot">&lt;-</span><span class="fu">svyby</span>(<span class="at">formula =</span> <span class="sc">~</span>badhealth, <span class="at">by=</span><span class="sc">~</span>male<span class="sc">+</span>agec<span class="sc">+</span>ins, <span class="at">design =</span> des, <span class="at">FUN=</span>svymean)</span>
<span id="cb277-3"><a href="survey-data-analysis.html#cb277-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-4"><a href="survey-data-analysis.html#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="fu">svychisq</span>(<span class="sc">~</span>badhealth<span class="sc">+</span>male, <span class="at">design =</span> des)</span></code></pre></div>
<pre><code>Pearson&#39;s X^2: Rao &amp; Scott adjustment</code></pre>
<p>data: svychisq(~badhealth + male, design = des)
F = 2, ndf = 1, ddf = 8486, p-value = 0.1</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="survey-data-analysis.html#cb279-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(cat,</span>
<span id="cb279-2"><a href="survey-data-analysis.html#cb279-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Survey Estimates of Poor SRH by Sex&quot;</span>,</span>
<span id="cb279-3"><a href="survey-data-analysis.html#cb279-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">&#39;c&#39;</span>,  </span>
<span id="cb279-4"><a href="survey-data-analysis.html#cb279-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-127">Table 4.2: </span>Survey Estimates of Poor SRH by Sex
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
male
</th>
<th style="text-align:center;">
agec
</th>
<th style="text-align:center;">
ins
</th>
<th style="text-align:center;">
badhealth
</th>
<th style="text-align:center;">
se
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Female.(0,24].0
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(0,24]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.144
</td>
<td style="text-align:center;">
0.070
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(0,24].0
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(0,24]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.203
</td>
<td style="text-align:center;">
0.077
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(24,39].0
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(24,39]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.277
</td>
<td style="text-align:center;">
0.056
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(24,39].0
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(24,39]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.227
</td>
<td style="text-align:center;">
0.042
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(39,59].0
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(39,59]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.286
</td>
<td style="text-align:center;">
0.053
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(39,59].0
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(39,59]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.262
</td>
<td style="text-align:center;">
0.049
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(59,79].0
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(59,79]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.270
</td>
<td style="text-align:center;">
0.086
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(59,79].0
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(59,79]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.348
</td>
<td style="text-align:center;">
0.129
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(79,99].0
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(79,99]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.215
</td>
<td style="text-align:center;">
0.129
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(79,99].0
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(79,99]
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.097
</td>
<td style="text-align:center;">
0.115
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(0,24].1
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(0,24]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.133
</td>
<td style="text-align:center;">
0.037
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(0,24].1
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(0,24]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.077
</td>
<td style="text-align:center;">
0.032
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(24,39].1
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(24,39]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.123
</td>
<td style="text-align:center;">
0.022
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(24,39].1
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(24,39]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.068
</td>
<td style="text-align:center;">
0.021
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(39,59].1
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(39,59]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.211
</td>
<td style="text-align:center;">
0.028
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(39,59].1
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(39,59]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.193
</td>
<td style="text-align:center;">
0.026
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(59,79].1
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(59,79]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.257
</td>
<td style="text-align:center;">
0.027
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(59,79].1
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(59,79]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.227
</td>
<td style="text-align:center;">
0.028
</td>
</tr>
<tr>
<td style="text-align:left;">
Female.(79,99].1
</td>
<td style="text-align:center;">
Female
</td>
<td style="text-align:center;">
(79,99]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.379
</td>
<td style="text-align:center;">
0.067
</td>
</tr>
<tr>
<td style="text-align:left;">
Male.(79,99].1
</td>
<td style="text-align:center;">
Male
</td>
<td style="text-align:center;">
(79,99]
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.401
</td>
<td style="text-align:center;">
0.101
</td>
</tr>
</tbody>
</table>
<p>Which gives the same %’s as the weighted table above, but we also want
the correct standard errors for our bad health prevalence.</p>
<p>The <code>svyby()</code> function will calculate statistics by groups, in this case
we want the % in bad health by each level of education. The %’s can be
gotten using the <code>svymean()</code> function, which finds means of variables
using survey design:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="survey-data-analysis.html#cb280-1" aria-hidden="true" tabindex="-1"></a>sv.table<span class="ot">&lt;-</span><span class="fu">svyby</span>(<span class="at">formula =</span> <span class="sc">~</span>badhealth, <span class="at">by =</span> <span class="sc">~</span>educ, <span class="at">design =</span> des, <span class="at">FUN =</span> svymean, <span class="at">na.rm=</span>T)</span>
<span id="cb280-2"><a href="survey-data-analysis.html#cb280-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-3"><a href="survey-data-analysis.html#cb280-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-4"><a href="survey-data-analysis.html#cb280-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(sv.table,</span>
<span id="cb280-5"><a href="survey-data-analysis.html#cb280-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Survey Estimates of Poor SRH by Education&quot;</span>,</span>
<span id="cb280-6"><a href="survey-data-analysis.html#cb280-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">&#39;c&#39;</span>,  </span>
<span id="cb280-7"><a href="survey-data-analysis.html#cb280-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-128">Table 4.3: </span>Survey Estimates of Poor SRH by Education
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
educ
</th>
<th style="text-align:center;">
badhealth
</th>
<th style="text-align:center;">
se
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2hsgrad
</td>
<td style="text-align:center;">
2hsgrad
</td>
<td style="text-align:center;">
0.242
</td>
<td style="text-align:center;">
0.019
</td>
</tr>
<tr>
<td style="text-align:left;">
0Prim
</td>
<td style="text-align:center;">
0Prim
</td>
<td style="text-align:center;">
0.400
</td>
<td style="text-align:center;">
0.048
</td>
</tr>
<tr>
<td style="text-align:left;">
1somehs
</td>
<td style="text-align:center;">
1somehs
</td>
<td style="text-align:center;">
0.331
</td>
<td style="text-align:center;">
0.043
</td>
</tr>
<tr>
<td style="text-align:left;">
3somecol
</td>
<td style="text-align:center;">
3somecol
</td>
<td style="text-align:center;">
0.165
</td>
<td style="text-align:center;">
0.015
</td>
</tr>
<tr>
<td style="text-align:left;">
4colgrad
</td>
<td style="text-align:center;">
4colgrad
</td>
<td style="text-align:center;">
0.089
</td>
<td style="text-align:center;">
0.009
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="survey-data-analysis.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make a survey design that is random sampling - no survey information</span></span>
<span id="cb281-2"><a href="survey-data-analysis.html#cb281-2" aria-hidden="true" tabindex="-1"></a>nodes<span class="ot">&lt;-</span><span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>,  <span class="at">weights =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> brfss_17)</span>
<span id="cb281-3"><a href="survey-data-analysis.html#cb281-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-4"><a href="survey-data-analysis.html#cb281-4" aria-hidden="true" tabindex="-1"></a>sv.table<span class="ot">&lt;-</span><span class="fu">svyby</span>(<span class="at">formula =</span> <span class="sc">~</span><span class="fu">factor</span>(badhealth), <span class="at">by =</span> <span class="sc">~</span>educ, <span class="at">design =</span> nodes, <span class="at">FUN =</span> svymean, <span class="at">na.rm=</span>T)</span>
<span id="cb281-5"><a href="survey-data-analysis.html#cb281-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-6"><a href="survey-data-analysis.html#cb281-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-7"><a href="survey-data-analysis.html#cb281-7" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(brfss_17<span class="sc">$</span>sex, brfss_17<span class="sc">$</span>badhealth))</span></code></pre></div>
<pre><code>     0      1</code></pre>
<p>1 0.3400 0.0776
2 0.4499 0.1325</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="survey-data-analysis.html#cb283-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(sv.table,</span>
<span id="cb283-2"><a href="survey-data-analysis.html#cb283-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Estimates of Poor SRH by Education - No survey design&quot;</span>,</span>
<span id="cb283-3"><a href="survey-data-analysis.html#cb283-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">&#39;c&#39;</span>,  </span>
<span id="cb283-4"><a href="survey-data-analysis.html#cb283-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:unnamed-chunk-128">Table 4.3: </span>Estimates of Poor SRH by Education - No survey design
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
educ
</th>
<th style="text-align:center;">
factor(badhealth)0
</th>
<th style="text-align:center;">
factor(badhealth)1
</th>
<th style="text-align:center;">
se.factor(badhealth)0
</th>
<th style="text-align:center;">
se.factor(badhealth)1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2hsgrad
</td>
<td style="text-align:center;">
2hsgrad
</td>
<td style="text-align:center;">
0.709
</td>
<td style="text-align:center;">
0.291
</td>
<td style="text-align:center;">
0.010
</td>
<td style="text-align:center;">
0.010
</td>
</tr>
<tr>
<td style="text-align:left;">
0Prim
</td>
<td style="text-align:center;">
0Prim
</td>
<td style="text-align:center;">
0.569
</td>
<td style="text-align:center;">
0.431
</td>
<td style="text-align:center;">
0.026
</td>
<td style="text-align:center;">
0.026
</td>
</tr>
<tr>
<td style="text-align:left;">
1somehs
</td>
<td style="text-align:center;">
1somehs
</td>
<td style="text-align:center;">
0.623
</td>
<td style="text-align:center;">
0.377
</td>
<td style="text-align:center;">
0.022
</td>
<td style="text-align:center;">
0.022
</td>
</tr>
<tr>
<td style="text-align:left;">
3somecol
</td>
<td style="text-align:center;">
3somecol
</td>
<td style="text-align:center;">
0.780
</td>
<td style="text-align:center;">
0.220
</td>
<td style="text-align:center;">
0.009
</td>
<td style="text-align:center;">
0.009
</td>
</tr>
<tr>
<td style="text-align:left;">
4colgrad
</td>
<td style="text-align:center;">
4colgrad
</td>
<td style="text-align:center;">
0.884
</td>
<td style="text-align:center;">
0.116
</td>
<td style="text-align:center;">
0.005
</td>
<td style="text-align:center;">
0.005
</td>
</tr>
</tbody>
</table>
<p>And we see the same point estimates of our prevalences as in the simple
weighted table, but the standard errors have now been adjusted for
survey design as well, so they are also correct. You also see they are
much larger than the ones we computed above, which assumed random
sampling.</p>
</div>
<div id="another-way" class="section level3" number="4.12.7">
<h3><span class="header-section-number">4.12.7</span> Another way</h3>
<p>There’s this great R package, <code>tableone</code> that does this stuff very
nicely and incorporates survey design too. Here’s an example of using it
to generate your bi-variate tests like above:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="survey-data-analysis.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tableone)</span>
<span id="cb284-2"><a href="survey-data-analysis.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="co">#not using survey design</span></span>
<span id="cb284-3"><a href="survey-data-analysis.html#cb284-3" aria-hidden="true" tabindex="-1"></a>t1<span class="ot">&lt;-</span><span class="fu">CreateTableOne</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;educ&quot;</span>, <span class="st">&quot;marst&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;badhealth&quot;</span>),<span class="at">strata=</span><span class="st">&quot;race_eth&quot;</span>, <span class="at">data =</span> brfss_17)</span>
<span id="cb284-4"><a href="survey-data-analysis.html#cb284-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-5"><a href="survey-data-analysis.html#cb284-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-6"><a href="survey-data-analysis.html#cb284-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-7"><a href="survey-data-analysis.html#cb284-7" aria-hidden="true" tabindex="-1"></a><span class="co">#t1&lt;-print(t1, format=&quot;p&quot;)</span></span>
<span id="cb284-8"><a href="survey-data-analysis.html#cb284-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t1,<span class="at">format=</span><span class="st">&quot;p&quot;</span> )</span></code></pre></div>
<pre><code>##                        Stratified by race_eth
##                         hispanic    nh black    nh multirace nh other   
##   n                     1957         756         117          320       
##   educ (%)                                                              
##      2hsgrad            27.5        28.7        19.7         12.5       
##      0Prim              15.7         1.3         3.4          0.9       
##      1somehs            12.6         7.4         1.7          3.1       
##      3somecol           22.6        28.6        33.3         18.8       
##      4colgrad           21.5        34.0        41.9         64.7       
##   marst (%)                                                             
##      married            48.0        31.9        41.9         62.3       
##      cohab               6.7         1.3         5.1          1.9       
##      divorced           11.4        18.0        12.0          6.6       
##      nm                 20.2        26.8        20.5         19.5       
##      separated           5.5         5.6         6.0          1.9       
##      widowed             8.1        16.4        14.5          7.9       
##   male = Male (%)       41.1        35.3        41.0         54.4       
##   badhealth (mean (SD)) 0.26 (0.44) 0.29 (0.46) 0.31 (0.46)  0.13 (0.34)
##                        Stratified by race_eth
##                         nhwhite     p      test
##   n                     5189                   
##   educ (%)                          &lt;0.001     
##      2hsgrad            20.3                   
##      0Prim               0.6                   
##      1somehs             2.7                   
##      3somecol           27.1                   
##      4colgrad           49.3                   
##   marst (%)                         &lt;0.001     
##      married            54.6                   
##      cohab               2.2                   
##      divorced           13.1                   
##      nm                 11.6                   
##      separated           1.1                   
##      widowed            17.3                   
##   male = Male (%)       42.1        &lt;0.001     
##   badhealth (mean (SD)) 0.18 (0.38) &lt;0.001</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="survey-data-analysis.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co">#, strata = &quot;badhealth&quot;, test = T,</span></span>
<span id="cb286-2"><a href="survey-data-analysis.html#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="co">#using survey design</span></span>
<span id="cb286-3"><a href="survey-data-analysis.html#cb286-3" aria-hidden="true" tabindex="-1"></a>st1<span class="ot">&lt;-</span><span class="fu">svyCreateTableOne</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;educ&quot;</span>, <span class="st">&quot;marst&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;badhealth&quot;</span>), <span class="at">strata =</span> <span class="st">&quot;race_eth&quot;</span>, <span class="at">test =</span> T, <span class="at">data =</span> des)</span>
<span id="cb286-4"><a href="survey-data-analysis.html#cb286-4" aria-hidden="true" tabindex="-1"></a><span class="co">#st1&lt;-print(st1, format=&quot;p&quot;)</span></span>
<span id="cb286-5"><a href="survey-data-analysis.html#cb286-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(st1, <span class="at">format=</span><span class="st">&quot;p&quot;</span>)</span></code></pre></div>
<pre><code>##                        Stratified by race_eth
##                         hispanic          nh black          nh multirace    
##   n                      5177397.2         1978300.5         159546.0       
##   educ (%)                                                                  
##      2hsgrad                  29.0              29.1             27.5       
##      0Prim                    20.7               0.2              0.1       
##      1somehs                  15.7               5.6              1.3       
##      3somecol                 23.8              40.9             37.3       
##      4colgrad                 10.7              24.3             33.7       
##   marst (%)                                                                 
##      married                  49.5              37.4             47.5       
##      cohab                     8.8               0.8              7.2       
##      divorced                  8.6              16.8              8.1       
##      nm                       26.1              34.0             18.9       
##      separated                 4.7               6.0              4.0       
##      widowed                   2.3               5.0             14.3       
##   male = Male (%)             49.8              45.9             33.9       
##   badhealth (mean (SD))       0.23 (0.42)       0.22 (0.42)      0.13 (0.34)
##                        Stratified by race_eth
##                         nh other          nhwhite           p      test
##   n                      1059547.6         6556786.6                   
##   educ (%)                                                  &lt;0.001     
##      2hsgrad                  15.6              21.9                   
##      0Prim                     5.3               1.1                   
##      1somehs                   3.6               3.4                   
##      3somecol                 26.1              34.4                   
##      4colgrad                 49.4              39.3                   
##   marst (%)                                                 &lt;0.001     
##      married                  59.9              57.8                   
##      cohab                     2.1               4.2                   
##      divorced                  2.0              11.2                   
##      nm                       32.4              17.6                   
##      separated                 1.0               1.4                   
##      widowed                   2.7               7.7                   
##   male = Male (%)             48.8              49.0         0.595     
##   badhealth (mean (SD))       0.12 (0.32)       0.16 (0.37)  0.001</code></pre>
</div>
</div>
<div id="regression-example" class="section level2" number="4.13">
<h2><span class="header-section-number">4.13</span> Regression example</h2>
<p>Next we apply this logic to a regression case. First we fit the OLS
model for our BMI outcome using education and age as predictors:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="survey-data-analysis.html#cb288-1" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">&lt;-</span><span class="fu">lm</span>(bmi<span class="sc">~</span>educ<span class="sc">+</span>agec, <span class="at">data=</span>brfss_17)</span></code></pre></div>
<p>Next we incorporate case weights</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="survey-data-analysis.html#cb289-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">&lt;-</span><span class="fu">lm</span>(bmi<span class="sc">~</span>educ<span class="sc">+</span>agec, <span class="at">data=</span>brfss_17, <span class="at">weights =</span> mmsawt)</span></code></pre></div>
<p>Now we will incorporate design effects as well:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="survey-data-analysis.html#cb290-1" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">&lt;-</span><span class="fu">svyglm</span>(bmi<span class="sc">~</span>educ<span class="sc">+</span>agec,des, <span class="at">family=</span>gaussian)</span></code></pre></div>
<p>Now I make a table to show the results of the three models:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="survey-data-analysis.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(fit1, fit2, fit3, <span class="at">style=</span><span class="st">&quot;demography&quot;</span>, <span class="at">type=</span><span class="st">&quot;html&quot;</span>,</span>
<span id="cb291-2"><a href="survey-data-analysis.html#cb291-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">column.labels =</span> <span class="fu">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Weights Only&quot;</span>, <span class="st">&quot;Survey Design&quot;</span>),</span>
<span id="cb291-3"><a href="survey-data-analysis.html#cb291-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&quot;Regression models for BMI using survey data - BRFSS 2016&quot;</span>, </span>
<span id="cb291-4"><a href="survey-data-analysis.html#cb291-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">covariate.labels=</span><span class="fu">c</span>(<span class="st">&quot;PrimarySchool&quot;</span>, <span class="st">&quot;SomeHS&quot;</span>, <span class="st">&quot;SomeColl&quot;</span>, <span class="st">&quot;CollGrad&quot;</span>, <span class="st">&quot;Age 24-39&quot;</span>,<span class="st">&quot;Age 39-59&quot;</span> ,<span class="st">&quot;Age 59-79&quot;</span>, <span class="st">&quot;Age 80+&quot;</span>), </span>
<span id="cb291-5"><a href="survey-data-analysis.html#cb291-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">keep.stat=</span><span class="st">&quot;n&quot;</span>, <span class="at">model.names=</span>F, <span class="at">align=</span>T, <span class="at">ci=</span>T)</span></code></pre></div>
<table style="text-align:center">
<caption>
<strong>Regression models for BMI using survey data - BRFSS 2016</strong>
</caption>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
bmi
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
OLS
</td>
<td>
Weights Only
</td>
<td>
Survey Design
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
Model 1
</td>
<td>
Model 2
</td>
<td>
Model 3
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
PrimarySchool
</td>
<td>
0.114
</td>
<td>
-0.521
</td>
<td>
-0.521
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(-0.671, 0.899)
</td>
<td>
(-1.090, 0.046)
</td>
<td>
(-1.800, 0.756)
</td>
</tr>
<tr>
<td style="text-align:left">
SomeHS
</td>
<td>
-0.006
</td>
<td>
-0.699<sup>*</sup>
</td>
<td>
-0.699
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(-0.687, 0.674)
</td>
<td>
(-1.270, -0.132)
</td>
<td>
(-2.080, 0.682)
</td>
</tr>
<tr>
<td style="text-align:left">
SomeColl
</td>
<td>
-0.456<sup>*</sup>
</td>
<td>
-1.250<sup>***</sup>
</td>
<td>
-1.250<sup>**</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(-0.860, -0.052)
</td>
<td>
(-1.620, -0.892)
</td>
<td>
(-2.090, -0.417)
</td>
</tr>
<tr>
<td style="text-align:left">
CollGrad
</td>
<td>
-1.970<sup>***</sup>
</td>
<td>
-2.460<sup>***</sup>
</td>
<td>
-2.460<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(-2.340, -1.600)
</td>
<td>
(-2.840, -2.090)
</td>
<td>
(-3.230, -1.700)
</td>
</tr>
<tr>
<td style="text-align:left">
Age 24-39
</td>
<td>
2.940<sup>***</sup>
</td>
<td>
3.220<sup>***</sup>
</td>
<td>
3.220<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(2.260, 3.620)
</td>
<td>
(2.770, 3.670)
</td>
<td>
(2.350, 4.100)
</td>
</tr>
<tr>
<td style="text-align:left">
Age 39-59
</td>
<td>
4.390<sup>***</sup>
</td>
<td>
4.750<sup>***</sup>
</td>
<td>
4.750<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(3.740, 5.030)
</td>
<td>
(4.310, 5.180)
</td>
<td>
(3.870, 5.620)
</td>
</tr>
<tr>
<td style="text-align:left">
Age 59-79
</td>
<td>
3.480<sup>***</sup>
</td>
<td>
4.000<sup>***</sup>
</td>
<td>
4.000<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(2.850, 4.110)
</td>
<td>
(3.530, 4.480)
</td>
<td>
(3.040, 4.970)
</td>
</tr>
<tr>
<td style="text-align:left">
Age 80+
</td>
<td>
0.810<sup>*</sup>
</td>
<td>
0.819
</td>
<td>
0.819
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.076, 1.540)
</td>
<td>
(-0.051, 1.690)
</td>
<td>
(-0.496, 2.130)
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
26.000<sup>***</sup>
</td>
<td>
26.200<sup>***</sup>
</td>
<td>
26.200<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(25.400, 26.700)
</td>
<td>
(25.800, 26.600)
</td>
<td>
(25.300, 27.000)
</td>
</tr>
<tr>
<td style="text-align:left">
<em>N</em>
</td>
<td>
7,840
</td>
<td>
7,840
</td>
<td>
7,840
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td colspan="4" style="text-align:left">
<sup><em></sup>p &lt; .05; <sup><strong></sup>p &lt; .01; <sup></strong></em></sup>p &lt; .001
</td>
</tr>
</table>
<p>Notice, the results for the education levels are much <em>less</em> significant
than the were with either of the other two analysis. This is because
those models had standard errors for the parameters that were too small.
You see all the standard errors are larger and the T statistics are
smaller.</p>
<p>Which shows the same <span class="math inline">\(\beta\)</span>’s between the survey design model and the
weighted model but the standard errors are larger in the survey model,
so the test statistics are more conservative (smaller t statistics).</p>
<p>While in this simple model, our overall interpretation of the effects do
not change (positive effects of education, negative effects of age), it
is entirely possible that they could once we include our survey design
effects.</p>
<p>It may be informative to plot the results of the models to see how
different the coefficients are from one another:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="survey-data-analysis.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb292-2"><a href="survey-data-analysis.html#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb292-3"><a href="survey-data-analysis.html#cb292-3" aria-hidden="true" tabindex="-1"></a>coefs<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">coefs=</span><span class="fu">c</span>(<span class="fu">coef</span>(fit1)[<span class="sc">-</span><span class="dv">1</span>], <span class="fu">coef</span>(fit3)[<span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb292-4"><a href="survey-data-analysis.html#cb292-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mod=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Non Survey Model&quot;</span>, <span class="dv">8</span>),<span class="fu">rep</span>(<span class="st">&quot;Survey Model&quot;</span>, <span class="dv">8</span>)),</span>
<span id="cb292-5"><a href="survey-data-analysis.html#cb292-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">effect=</span><span class="fu">rep</span>(<span class="fu">names</span>(<span class="fu">coef</span>(fit1)[<span class="sc">-</span><span class="dv">1</span>]), <span class="dv">2</span>))</span>
<span id="cb292-6"><a href="survey-data-analysis.html#cb292-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-7"><a href="survey-data-analysis.html#cb292-7" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">%&gt;%</span></span>
<span id="cb292-8"><a href="survey-data-analysis.html#cb292-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb292-9"><a href="survey-data-analysis.html#cb292-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>( <span class="at">x=</span>effect, <span class="at">y=</span>coefs, <span class="at">group=</span>effect,<span class="at">color=</span>effect, <span class="at">shape=</span>mod),</span>
<span id="cb292-10"><a href="survey-data-analysis.html#cb292-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">position=</span><span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="dv">1</span>),</span>
<span id="cb292-11"><a href="survey-data-analysis.html#cb292-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb292-12"><a href="survey-data-analysis.html#cb292-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Regression Coefficient&quot;</span>)<span class="sc">+</span></span>
<span id="cb292-13"><a href="survey-data-analysis.html#cb292-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Beta&quot;</span>)<span class="sc">+</span></span>
<span id="cb292-14"><a href="survey-data-analysis.html#cb292-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope=</span><span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb292-15"><a href="survey-data-analysis.html#cb292-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb292-16"><a href="survey-data-analysis.html#cb292-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">&quot;Comparison of Survey and Non-Survey Regression effects&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
<p>Which shows us that the betas are similar but have some differences
between the two models.</p>
</div>
<div id="creating-survey-estimates-for-places" class="section level2" number="4.14">
<h2><span class="header-section-number">4.14</span> Creating Survey estimates for places</h2>
<p>One of the coolest ways to use the BRFSS is to calculate estimates for
places, and by demographic characteristics withing places. Again, we use
<code>svyby()</code> to do this, but now we calculate obesity rates by sex within
cities.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="survey-data-analysis.html#cb293-1" aria-hidden="true" tabindex="-1"></a>citytab<span class="ot">&lt;-</span><span class="fu">svyby</span>(<span class="sc">~</span>obese, <span class="sc">~</span>mmsaname, <span class="at">design=</span>des,<span class="at">FUN =</span> svymean, <span class="at">na.rm=</span>T )</span>
<span id="cb293-2"><a href="survey-data-analysis.html#cb293-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(citytab, <span class="at">type=</span><span class="st">&quot;html&quot;</span>, <span class="at">digits=</span><span class="dv">3</span>,<span class="at">caption =</span> <span class="st">&quot;Obesity Estimats for TX MSAs&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-135">Table 4.4: </span>Obesity Estimats for TX MSAs</caption>
<colgroup>
<col width="45%" />
<col width="45%" />
<col width="4%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">mmsaname</th>
<th align="right">obese</th>
<th align="right">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Austin-Round Rock, TX, Metropolitan Statistical Area</td>
<td align="left">Austin-Round Rock, TX, Metropolitan Statistical Area</td>
<td align="right">0.294</td>
<td align="right">0.021</td>
</tr>
<tr class="even">
<td align="left">College Station-Bryan, TX, Metropolitan Statistical Area</td>
<td align="left">College Station-Bryan, TX, Metropolitan Statistical Area</td>
<td align="right">0.308</td>
<td align="right">0.052</td>
</tr>
<tr class="odd">
<td align="left">Corpus Christi, TX, Metropolitan Statistical Area</td>
<td align="left">Corpus Christi, TX, Metropolitan Statistical Area</td>
<td align="right">0.362</td>
<td align="right">0.034</td>
</tr>
<tr class="even">
<td align="left">Dallas-Plano-Irving, TX, Metropolitan Division</td>
<td align="left">Dallas-Plano-Irving, TX, Metropolitan Division</td>
<td align="right">0.286</td>
<td align="right">0.025</td>
</tr>
<tr class="odd">
<td align="left">El Paso, TX, Metropolitan Statistical Area</td>
<td align="left">El Paso, TX, Metropolitan Statistical Area</td>
<td align="right">0.347</td>
<td align="right">0.029</td>
</tr>
<tr class="even">
<td align="left">Fort Worth-Arlington, TX, Metropolitan Division</td>
<td align="left">Fort Worth-Arlington, TX, Metropolitan Division</td>
<td align="right">0.367</td>
<td align="right">0.028</td>
</tr>
<tr class="odd">
<td align="left">Houston-The Woodlands-Sugar Land, TX, Metropolitan Statistical Area</td>
<td align="left">Houston-The Woodlands-Sugar Land, TX, Metropolitan Statistical Area</td>
<td align="right">0.307</td>
<td align="right">0.022</td>
</tr>
<tr class="even">
<td align="left">San Antonio-New Braunfels, TX, Metropolitan Statistical Area</td>
<td align="left">San Antonio-New Braunfels, TX, Metropolitan Statistical Area</td>
<td align="right">0.308</td>
<td align="right">0.033</td>
</tr>
<tr class="odd">
<td align="left">Wichita Falls, TX, Metropolitan Statistical Area</td>
<td align="left">Wichita Falls, TX, Metropolitan Statistical Area</td>
<td align="right">0.425</td>
<td align="right">0.055</td>
</tr>
</tbody>
</table>
<div id="using-srvyr" class="section level3" number="4.14.1">
<h3><span class="header-section-number">4.14.1</span> Using srvyr</h3>
<p>There’s a new package called <code>srvyr</code> that incorporates the survey
analysis stuff into the <code>dplyr</code> universe:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="survey-data-analysis.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb294-2"><a href="survey-data-analysis.html#cb294-2" aria-hidden="true" tabindex="-1"></a>brfsurv<span class="ot">&lt;-</span>brfss_17<span class="sc">%&gt;%</span></span>
<span id="cb294-3"><a href="survey-data-analysis.html#cb294-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="dv">1</span>,<span class="at">strata=</span>ststr,<span class="at">weights=</span>mmsawt )</span>
<span id="cb294-4"><a href="survey-data-analysis.html#cb294-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-5"><a href="survey-data-analysis.html#cb294-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-6"><a href="survey-data-analysis.html#cb294-6" aria-hidden="true" tabindex="-1"></a>brfsurv<span class="sc">%&gt;%</span></span>
<span id="cb294-7"><a href="survey-data-analysis.html#cb294-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mmsaname)<span class="sc">%&gt;%</span></span>
<span id="cb294-8"><a href="survey-data-analysis.html#cb294-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">obprev =</span> <span class="fu">survey_mean</span>(obese, <span class="at">na.rm=</span>T))</span></code></pre></div>
</div>
</div>
<div id="replicate-weights" class="section level2" number="4.15">
<h2><span class="header-section-number">4.15</span> Replicate Weights</h2>
<p>If your dataset comes with <em>replicate weights</em>, you have to specify the
survey design slightly differently. Here is an example using the IPUMS
CPS data. For this data, you can get information
<a href="https://cps.ipums.org/cps/repwt.shtml">here</a>, but you must consult your
specific data source for the appropriate information for your data.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="survey-data-analysis.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">&quot;https://github.com/coreysparks/data/blob/master/cpsmar10tx.Rdata?raw=true&quot;</span>))</span>
<span id="cb295-2"><a href="survey-data-analysis.html#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cpsmar10tx)</span></code></pre></div>
<pre><code>##   [1] &quot;year&quot;     &quot;serial&quot;   &quot;hwtsupp&quot;  &quot;repwt&quot;    &quot;statefip&quot; &quot;metarea&quot; 
##   [7] &quot;foodstmp&quot; &quot;REPWT1&quot;   &quot;REPWT2&quot;   &quot;REPWT3&quot;   &quot;REPWT4&quot;   &quot;REPWT5&quot;  
##  [13] &quot;REPWT6&quot;   &quot;REPWT7&quot;   &quot;REPWT8&quot;   &quot;REPWT9&quot;   &quot;REPWT10&quot;  &quot;REPWT11&quot; 
##  [19] &quot;REPWT12&quot;  &quot;REPWT13&quot;  &quot;REPWT14&quot;  &quot;REPWT15&quot;  &quot;REPWT16&quot;  &quot;REPWT17&quot; 
##  [25] &quot;REPWT18&quot;  &quot;REPWT19&quot;  &quot;REPWT20&quot;  &quot;REPWT21&quot;  &quot;REPWT22&quot;  &quot;REPWT23&quot; 
##  [31] &quot;REPWT24&quot;  &quot;REPWT25&quot;  &quot;REPWT26&quot;  &quot;REPWT27&quot;  &quot;REPWT28&quot;  &quot;REPWT29&quot; 
##  [37] &quot;REPWT30&quot;  &quot;REPWT31&quot;  &quot;REPWT32&quot;  &quot;REPWT33&quot;  &quot;REPWT34&quot;  &quot;REPWT35&quot; 
##  [43] &quot;REPWT36&quot;  &quot;REPWT37&quot;  &quot;REPWT38&quot;  &quot;REPWT39&quot;  &quot;REPWT40&quot;  &quot;REPWT41&quot; 
##  [49] &quot;REPWT42&quot;  &quot;REPWT43&quot;  &quot;REPWT44&quot;  &quot;REPWT45&quot;  &quot;REPWT46&quot;  &quot;REPWT47&quot; 
##  [55] &quot;REPWT48&quot;  &quot;REPWT49&quot;  &quot;REPWT50&quot;  &quot;REPWT51&quot;  &quot;REPWT52&quot;  &quot;REPWT53&quot; 
##  [61] &quot;REPWT54&quot;  &quot;REPWT55&quot;  &quot;REPWT56&quot;  &quot;REPWT57&quot;  &quot;REPWT58&quot;  &quot;REPWT59&quot; 
##  [67] &quot;REPWT60&quot;  &quot;REPWT61&quot;  &quot;REPWT62&quot;  &quot;REPWT63&quot;  &quot;REPWT64&quot;  &quot;REPWT65&quot; 
##  [73] &quot;REPWT66&quot;  &quot;REPWT67&quot;  &quot;REPWT68&quot;  &quot;REPWT69&quot;  &quot;REPWT70&quot;  &quot;REPWT71&quot; 
##  [79] &quot;REPWT72&quot;  &quot;REPWT73&quot;  &quot;REPWT74&quot;  &quot;REPWT75&quot;  &quot;REPWT76&quot;  &quot;REPWT77&quot; 
##  [85] &quot;REPWT78&quot;  &quot;REPWT79&quot;  &quot;REPWT80&quot;  &quot;REPWT81&quot;  &quot;REPWT82&quot;  &quot;REPWT83&quot; 
##  [91] &quot;REPWT84&quot;  &quot;REPWT85&quot;  &quot;REPWT86&quot;  &quot;REPWT87&quot;  &quot;REPWT88&quot;  &quot;REPWT89&quot; 
##  [97] &quot;REPWT90&quot;  &quot;REPWT91&quot;  &quot;REPWT92&quot;  &quot;REPWT93&quot;  &quot;REPWT94&quot;  &quot;REPWT95&quot; 
## [103] &quot;REPWT96&quot;  &quot;REPWT97&quot;  &quot;REPWT98&quot;  &quot;REPWT99&quot;  &quot;REPWT100&quot; &quot;REPWT101&quot;
## [109] &quot;REPWT102&quot; &quot;REPWT103&quot; &quot;REPWT104&quot; &quot;REPWT105&quot; &quot;REPWT106&quot; &quot;REPWT107&quot;
## [115] &quot;REPWT108&quot; &quot;REPWT109&quot; &quot;REPWT110&quot; &quot;REPWT111&quot; &quot;REPWT112&quot; &quot;REPWT113&quot;
## [121] &quot;REPWT114&quot; &quot;REPWT115&quot; &quot;REPWT116&quot; &quot;REPWT117&quot; &quot;REPWT118&quot; &quot;REPWT119&quot;
## [127] &quot;REPWT120&quot; &quot;REPWT121&quot; &quot;REPWT122&quot; &quot;REPWT123&quot; &quot;REPWT124&quot; &quot;REPWT125&quot;
## [133] &quot;REPWT126&quot; &quot;REPWT127&quot; &quot;REPWT128&quot; &quot;REPWT129&quot; &quot;REPWT130&quot; &quot;REPWT131&quot;
## [139] &quot;REPWT132&quot; &quot;REPWT133&quot; &quot;REPWT134&quot; &quot;REPWT135&quot; &quot;REPWT136&quot; &quot;REPWT137&quot;
## [145] &quot;REPWT138&quot; &quot;REPWT139&quot; &quot;REPWT140&quot; &quot;REPWT141&quot; &quot;REPWT142&quot; &quot;REPWT143&quot;
## [151] &quot;REPWT144&quot; &quot;REPWT145&quot; &quot;REPWT146&quot; &quot;REPWT147&quot; &quot;REPWT148&quot; &quot;REPWT149&quot;
## [157] &quot;REPWT150&quot; &quot;REPWT151&quot; &quot;REPWT152&quot; &quot;REPWT153&quot; &quot;REPWT154&quot; &quot;REPWT155&quot;
## [163] &quot;REPWT156&quot; &quot;REPWT157&quot; &quot;REPWT158&quot; &quot;REPWT159&quot; &quot;REPWT160&quot; &quot;month&quot;   
## [169] &quot;pernum&quot;   &quot;wtsupp&quot;   &quot;relate&quot;   &quot;age&quot;      &quot;sex&quot;      &quot;race&quot;    
## [175] &quot;marst&quot;    &quot;offpov&quot;   &quot;MIGRATE1&quot;</code></pre>
<p>So we see the replicate weights are in columns 8 through 167 in the data</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="survey-data-analysis.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co">#simple binary outcome</span></span>
<span id="cb297-2"><a href="survey-data-analysis.html#cb297-2" aria-hidden="true" tabindex="-1"></a>cpsmar10tx<span class="sc">$</span>poverty<span class="ot">&lt;-</span><span class="fu">ifelse</span>(cpsmar10tx<span class="sc">$</span>offpov<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb297-3"><a href="survey-data-analysis.html#cb297-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-4"><a href="survey-data-analysis.html#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replicate weight design - I got these details from the data source, you should too</span></span>
<span id="cb297-5"><a href="survey-data-analysis.html#cb297-5" aria-hidden="true" tabindex="-1"></a>des2<span class="ot">&lt;-</span><span class="fu">svrepdesign</span>( <span class="at">data =</span> cpsmar10tx,<span class="at">repweights =</span> cpsmar10tx[, <span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">167</span>)]  ,</span>
<span id="cb297-6"><a href="survey-data-analysis.html#cb297-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span>wtsupp ,</span>
<span id="cb297-7"><a href="survey-data-analysis.html#cb297-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type=</span><span class="st">&quot;JK1&quot;</span>,</span>
<span id="cb297-8"><a href="survey-data-analysis.html#cb297-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scale=</span>.<span class="dv">025</span>)</span>
<span id="cb297-9"><a href="survey-data-analysis.html#cb297-9" aria-hidden="true" tabindex="-1"></a>des2</span></code></pre></div>
<pre><code>## Call: svrepdesign.default(data = cpsmar10tx, repweights = cpsmar10tx[, 
##     c(8:167)], weights = ~wtsupp, type = &quot;JK1&quot;, scale = 0.025)
## Unstratified cluster jacknife (JK1) with 160 replicates.</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="survey-data-analysis.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Without design</span></span>
<span id="cb299-2"><a href="survey-data-analysis.html#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(cpsmar10tx<span class="sc">$</span>poverty))</span></code></pre></div>
<pre><code>## 
##     0     1 
## 0.837 0.163</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="survey-data-analysis.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co">#with design</span></span>
<span id="cb301-2"><a href="survey-data-analysis.html#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">svytable</span>(<span class="sc">~</span>poverty, <span class="at">design =</span> des2))</span></code></pre></div>
<pre><code>## poverty
##     0     1 
## 0.848 0.152</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="survey-data-analysis.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Again, using the mean</span></span>
<span id="cb303-2"><a href="survey-data-analysis.html#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(cpsmar10tx<span class="sc">$</span>poverty)</span></code></pre></div>
<pre><code>## [1] 0.163</code></pre>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="survey-data-analysis.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the design. This would be an official estimate of poverty in TX in 2010:</span></span>
<span id="cb305-2"><a href="survey-data-analysis.html#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>poverty, <span class="at">design=</span>des2)</span></code></pre></div>
<pre><code>##          mean   SE
## poverty 0.152 0.01</code></pre>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Cameron, A. Colin, and Douglas L. Miller. 2015. <span>“A <span>Practitioner</span>’s <span>Guide</span> to <span>Cluster</span>-<span>Robust</span> <span>Inference</span>.”</span> <em>Journal of Human Resources</em> 50 (2): 317–72. <a href="https://doi.org/10.3368/jhr.50.2.317">https://doi.org/10.3368/jhr.50.2.317</a>.
</div>
<div class="csl-entry">
CDC. 2020. <span>“Weighting the BRFSS Data.”</span> <a href="https://www.cdc.gov/brfss/annual_data/2019/pdf/weighting-2019-508.pdf">https://www.cdc.gov/brfss/annual_data/2019/pdf/weighting-2019-508.pdf</a>.
</div>
<div class="csl-entry">
Hlavac, Marek. 2018. <em>Stargazer: Well-Formatted Regression and Summary Statistics Tables</em>. Bratislava, Slovakia: Central European Labour Studies Institute (CELSI). <a href="https://CRAN.R-project.org/package=stargazer">https://CRAN.R-project.org/package=stargazer</a>.
</div>
<div class="csl-entry">
Iannone, Richard, Joe Cheng, and Barret Schloerke. 2020. <em>Gt: Easily Create Presentation-Ready Display Tables</em>. <a href="https://CRAN.R-project.org/package=gt">https://CRAN.R-project.org/package=gt</a>.
</div>
<div class="csl-entry">
———. 2021. <em>Gt: Easily Create Presentation-Ready Display Tables</em>. <a href="https://CRAN.R-project.org/package=gt">https://CRAN.R-project.org/package=gt</a>.
</div>
<div class="csl-entry">
Ibragimov, Rustam, and Ulrich K. Müller. 2016. <span>“Inference with <span>Few</span> <span>Heterogeneous</span> <span>Clusters</span>.”</span> <em>The Review of Economics and Statistics</em> 98 (1): 83–96. <a href="https://doi.org/10.1162/REST_a_00545">https://doi.org/10.1162/REST_a_00545</a>.
</div>
<div class="csl-entry">
International, ICF. 2012. <span>“Demographic and <span>Health</span> <span>Survey</span> <span>Sampling</span> and <span>Household</span> <span>Listing</span> <span>Manual</span>.”</span> ICF International.
</div>
<div class="csl-entry">
Kleinman, Ken, and Nicholas J. Horton. 2014. <em>SAS and r: Data Management, Statistical Analysis, and Graphics, 2nd Edition</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://nhorton.people.amherst.edu/sasr2/">https://nhorton.people.amherst.edu/sasr2/</a>.
</div>
<div class="csl-entry">
Lohr, Shron. 2019. <em>Sampling: Design and Analysis</em>. 2nd ed. Boca Raton: Routledg/CRC Press.
</div>
<div class="csl-entry">
Lumley, Thomas. 2010. <em>Complex <span>Surveys</span>: <span>A</span> <span>Guide</span> to <span>Analysis</span> <span>Using</span> <span>R</span>: <span>A</span> <span>Guide</span> to <span>Analysis</span> <span>Using</span> <span>R</span></em>. John Wiley; Sons.
</div>
<div class="csl-entry">
Rao, JNK, and AJ Scott. 1984. <span>“On <span>Chi</span>-Squared <span>Tests</span> <span>For</span> <span>Multiway</span> <span>Contigency</span> <span>Tables</span> with <span>Proportions</span> <span>Estimated</span> <span>From</span> <span>Survey</span> <span>Data</span>.”</span> <em>Annals of Statistics</em> 12: 46–60.
</div>
<div class="csl-entry">
Ruggles, S, S Flood, Josiah Grover, S Foster, R Goeken, Jose Pacas, Erin Schouweiler, and M Sobek. 2021. <span>“Integrated <span>Public</span> <span>Use</span> <span>Microdata</span> <span>Series</span>: <span>Version</span> 11.0 [Machine-Readable Database].”</span> https://doi.org/<a href="https://doi.org/10.18128/D010.V8.0">https://doi.org/10.18128/D010.V8.0</a>.
</div>
<div class="csl-entry">
US Census Bureau. 2014. <span>“American Community Survey Design and Methodology (January 2014).”</span> <a href="https://www2.census.gov/programs-surveys/acs/methodology/design_and_methodology/acs_design_methodology_report_2014.pdf">https://www2.census.gov/programs-surveys/acs/methodology/design_and_methodology/acs_design_methodology_report_2014.pdf</a>.
</div>
<div class="csl-entry">
Walker, Kyle, and Matt Herman. 2021. <em>Tidycensus: Load US Census Boundary and Attribute Data as ’Tidyverse’ and ’Sf’-Ready Data Frames</em>. <a href="https://CRAN.R-project.org/package=tidycensus">https://CRAN.R-project.org/package=tidycensus</a>.
</div>
<div class="csl-entry">
Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div class="csl-entry">
———. n.d. <em><span>R Packages</span></em>. 1st ed. O’Reily. <a href="https://r-pkgs.org/">https://r-pkgs.org/</a>.
</div>
<div class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div class="csl-entry">
Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2020. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div class="csl-entry">
Wickham, Hadley, and Garrett Grolemund. 2017. <em>R for Data Science: Import, Tidy, Transform, Visualize, and Model Data</em>. 1st ed. Paperback; O’Reilly Media. <a href="http://r4ds.had.co.nz/">http://r4ds.had.co.nz/</a>.
</div>
<div class="csl-entry">
Wickham, Hadley, and Evan Miller. 2020. <em>Haven: Import and Export ’SPSS’, ’Stata’ and ’SAS’ Files</em>. <a href="https://CRAN.R-project.org/package=haven">https://CRAN.R-project.org/package=haven</a>.
</div>
</div>
</div>
</div>









<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-cdc2020" class="csl-entry">
CDC. 2020. <span>“Weighting the BRFSS Data.”</span> <a href="https://www.cdc.gov/brfss/annual_data/2019/pdf/weighting-2019-508.pdf">https://www.cdc.gov/brfss/annual_data/2019/pdf/weighting-2019-508.pdf</a>.
</div>
<div id="ref-stargazer" class="csl-entry">
Hlavac, Marek. 2018. <em>Stargazer: Well-Formatted Regression and Summary Statistics Tables</em>. Bratislava, Slovakia: Central European Labour Studies Institute (CELSI). <a href="https://CRAN.R-project.org/package=stargazer">https://CRAN.R-project.org/package=stargazer</a>.
</div>
<div id="ref-Iannone2021" class="csl-entry">
———. 2021. <em>Gt: Easily Create Presentation-Ready Display Tables</em>. <a href="https://CRAN.R-project.org/package=gt">https://CRAN.R-project.org/package=gt</a>.
</div>
<div id="ref-ibragimov_inference_2016" class="csl-entry">
Ibragimov, Rustam, and Ulrich K. Müller. 2016. <span>“Inference with <span>Few</span> <span>Heterogeneous</span> <span>Clusters</span>.”</span> <em>The Review of Economics and Statistics</em> 98 (1): 83–96. <a href="https://doi.org/10.1162/REST_a_00545">https://doi.org/10.1162/REST_a_00545</a>.
</div>
<div id="ref-international_demographic_2012" class="csl-entry">
International, ICF. 2012. <span>“Demographic and <span>Health</span> <span>Survey</span> <span>Sampling</span> and <span>Household</span> <span>Listing</span> <span>Manual</span>.”</span> ICF International.
</div>
<div id="ref-Lohr2019" class="csl-entry">
Lohr, Shron. 2019. <em>Sampling: Design and Analysis</em>. 2nd ed. Boca Raton: Routledg/CRC Press.
</div>
<div id="ref-lumley2010" class="csl-entry">
Lumley, Thomas. 2010. <em>Complex <span>Surveys</span>: <span>A</span> <span>Guide</span> to <span>Analysis</span> <span>Using</span> <span>R</span>: <span>A</span> <span>Guide</span> to <span>Analysis</span> <span>Using</span> <span>R</span></em>. John Wiley; Sons.
</div>
<div id="ref-rao_chi-squared_1984" class="csl-entry">
Rao, JNK, and AJ Scott. 1984. <span>“On <span>Chi</span>-Squared <span>Tests</span> <span>For</span> <span>Multiway</span> <span>Contigency</span> <span>Tables</span> with <span>Proportions</span> <span>Estimated</span> <span>From</span> <span>Survey</span> <span>Data</span>.”</span> <em>Annals of Statistics</em> 12: 46–60.
</div>
<div id="ref-Ruggles2021" class="csl-entry">
Ruggles, S, S Flood, Josiah Grover, S Foster, R Goeken, Jose Pacas, Erin Schouweiler, and M Sobek. 2021. <span>“Integrated <span>Public</span> <span>Use</span> <span>Microdata</span> <span>Series</span>: <span>Version</span> 11.0 [Machine-Readable Database].”</span> https://doi.org/<a href="https://doi.org/10.18128/D010.V8.0">https://doi.org/10.18128/D010.V8.0</a>.
</div>
<div id="ref-uscensusbureau2014" class="csl-entry">
US Census Bureau. 2014. <span>“American Community Survey Design and Methodology (January 2014).”</span> <a href="https://www2.census.gov/programs-surveys/acs/methodology/design_and_methodology/acs_design_methodology_report_2014.pdf">https://www2.census.gov/programs-surveys/acs/methodology/design_and_methodology/acs_design_methodology_report_2014.pdf</a>.
</div>
<div id="ref-walker21" class="csl-entry">
Walker, Kyle, and Matt Herman. 2021. <em>Tidycensus: Load US Census Boundary and Attribute Data as ’Tidyverse’ and ’Sf’-Ready Data Frames</em>. <a href="https://CRAN.R-project.org/package=tidycensus">https://CRAN.R-project.org/package=tidycensus</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>The modern DHS collects information on couples, men and children, so the universe has been expanded away from just women of childbearing age and their children.<a href="survey-data-analysis.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><a href="http://www.danieldsjoberg.com/gtsummary/" class="uri">http://www.danieldsjoberg.com/gtsummary/</a><a href="survey-data-analysis.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-r.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/03-surveystats.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
